!function(a,b){'use strict';b.planar=a;var c={mixin:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},indexOf:function(a,b){if(a)for(var c=0;c<b.length;c++)if(b[c]===a)return c;return-1},remove:function(a,b){var c=!1,d=this.indexOf(a,b);return d>=0&&(b.splice(d,1),c=!0),c},keys:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},values:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},isFunction:function(a){return"function"==typeof a},isUndefined:function(a){return"undefined"==typeof a},isArray:function(a){return"[object Array]"===Object.prototype.toString.apply(a)},isOfType:function(a,b){return a.constructor===b},checkExists:function(a,b){if(c.isUndefined(b)||null===b)throw{message:a+" must be specified"}},checkInArray:function(a,b,c){if(this.checkExists(a,b),-1===this.indexOf(b,c))throw{message:a+" must be one of "+c}},checkArray:function(a,b){if(!this.isArray(b))throw{message:a+" must be an array"}},checkNotEmpty:function(a,b){if(""===b)throw{message:a+" must not be empty"}},checkType:function(a,b,c){if(!this.isOfType(b,c))throw{message:a+" must be of type "+c}},generateId:function(){var a=1;return function(){return a++}}(),convertVarArgs:function(a){return a.length>0&&c.isArray(a[0])?a[0]:Array.prototype.slice.call(a)}},d=1,e=2,f=3,g=function(){return{initProperties:function(a){this.properties=[],this.graph=a},setProperty:function(a,b){c.checkExists("Property key",a),c.checkExists("Property value",b),c.checkNotEmpty("Property key",a);var d=this.properties[a];this.properties[a]=b,this.graph.indexManager.updateKeyIndexValue(a,b,d,this)},getProperty:function(a){return c.isUndefined(this.properties[a])?null:this.properties[a]},getPropertyKeys:function(){return c.keys(this.properties)},removeProperty:function(a){var b=this.getProperty(a);return delete this.properties[a],this.graph.indexManager.removeKeyIndexValue(a,b,this),b},getId:function(){return this.id}}}(),h=function(){function a(a,b,d,e,f){c.checkExists("ID",a),c.checkExists("Out vertex",b),c.checkExists("In vertex",d),this.id=a,this.outVertex=b,this.inVertex=d,this.label=e,this.initProperties(f)}return c.mixin(a.prototype,g),c.mixin(a.prototype,{getLabel:function(){return this.label},getInVertex:function(){return this.inVertex},getOutVertex:function(){return this.outVertex},getVertex:function(a){if(a===d)return this.outVertex;if(a===e)return this.inVertex;throw{message:"Invalid direction. Must be either IN or OUT"}},remove:function(){this.graph.removeEdge(this)}}),a}(),i=function(){function a(a,b){this.id=a,this.inEdges={},this.outEdges={},this.initProperties(b)}return c.mixin(a.prototype,g),c.mixin(a.prototype,{getEdges:function(a){var b=Array.prototype.slice.call(arguments,1);return new q(this).labels(b).direction(a).edges()},getVertices:function(a){var b=Array.prototype.slice.call(arguments,1);return new q(this).labels(b).direction(a).vertices()},addEdge:function(a,b){return this.graph.addEdge(null,this,b,a)},remove:function(){this.graph.removeVertex(this)},query:function(){return new q(this)}}),a}(),j=function(){function a(){this.vertices={},this.edges={},this.indexManager=new l(this)}return c.mixin(a.prototype,{addVertex:function(a){if(c.isUndefined(a)||null===a)for(a=c.generateId();null!==this.getVertex(a);)a=c.generateId();var b=this.getVertex(a);return b||(b=new i(a,this)),this.vertices[a]=b,b},getVertex:function(a){return c.checkExists("ID",a),c.isUndefined(this.vertices[a])?null:this.vertices[a]},removeVertex:function(a){c.checkExists("Vertex",a);var b=this.getVertex(a.id);if(b){var d;for(d in b.inEdges)this.removeEdge(b.inEdges[d]);for(d in b.outEdges)this.removeEdge(b.outEdges[d]);this.indexManager.removeElement(b),delete this.vertices[b.id]}},getVertices:function(a,b){return c.isUndefined(a)||null===a?c.values(this.vertices):new r(this).has(a,b).vertices()},addEdge:function(a,b,d,e){if(c.isUndefined(a)||null===a)for(a=c.generateId();null!==this.getEdge(a);)a=c.generateId();var f=new h(a,b,d,e,this);return this.edges[a]=f,b.outEdges[f.id]=f,d.inEdges[f.id]=f,f},getEdge:function(a){return c.checkExists("ID",a),c.isUndefined(this.edges[a])?null:this.edges[a]},removeEdge:function(a){if(a){var b=this.edges[a.id];b&&(this.indexManager.removeElement(b),delete this.edges[b.id],delete b.outVertex.outEdges[b.id],delete b.inVertex.inEdges[b.id])}},getEdges:function(a,b){return c.isUndefined(a)||null===a?c.values(this.edges):new r(this).has(a,b).edges()},forEachVertex:function(a){if(c.isFunction(a))for(var b in this.vertices)if(a(this.vertices[b]))return},forEachEdge:function(a){if(c.isFunction(a))for(var b in this.edges)if(a(this.edges[b]))return},query:function(){return new r(this)},createIndex:function(a,b){return this.indexManager.createIndex(a,b)},getIndex:function(a,b){return this.indexManager.getIndex(a,b)},getIndices:function(){return this.indexManager.getIndices()},dropIndex:function(a){this.indexManager.dropIndex(a)},createKeyIndex:function(a,b){return this.indexManager.createKeyIndex(a,b)},getIndexedKeys:function(a){return this.indexManager.getIndexedKeys(a)},dropKeyIndex:function(a,b){this.indexManager.dropKeyIndex(a,b)}}),a}(),k=function(){function a(a,b){c.checkExists("Name",a),c.checkExists("Type",b),this.name=a,this.type=b,this.index={}}return c.mixin(a.prototype,{getIndexName:function(){return this.name},getIndexType:function(){return this.type},put:function(a,b,d){c.checkExists("Key",a),c.checkExists("Value",b),c.checkType("Element",d,this.type);var e=this.index[a]=this.index[a]||{},f=e[b]=e[b]||{};f[d.getId()]=d},putAll:function(a,b){c.checkExists("Key",a),c.checkArray("Elements",b);for(var d=0;d<b.length;d++){var e=b[d];c.checkType("Element "+d,e,this.type);var f=e.getProperty(a);f&&this.put(a,f,e)}},get:function(a,b){var d=this.index[a]||{},e=d[b]||{};return c.values(e)},count:function(a,b){return this.get(a,b).length},remove:function(a,b,d){c.checkType("Element",d,this.type);var e=this.index[a];if(e){var f=e[b];f&&delete f[d.getId()]}},removeElement:function(a){c.checkType("Element",a,this.type);for(var b in this.index){var d=this.index[b];if(d)for(var e in d)delete d[e][a.getId()]}},removeKey:function(a){delete this.index[a]},getIndexedKeys:function(){return c.keys(this.index)},update:function(a,b,d,e){c.indexOf(a,this.getIndexedKeys())>-1&&(c.isUndefined(d)||this.remove(a,d,e),this.put(a,b,e))}}),a}(),l=function(){function a(a){c.checkExists("Graph",a),this.graph=a,this.indices={},this.vertexKeyIndex=new k(name,i),this.edgeKeyIndex=new k(name,h)}function b(a,b,c){return a.removeKey(c),a.index[c]={},a.putAll(c,b),a}return c.mixin(a.prototype,{createIndex:function(a,b){if(c.checkExists("Name",a),c.checkExists("Type",b),this.indices.hasOwnProperty(a))throw{message:"Index already exists"};var d=new k(a,b);return this.indices[a]=d,d},createKeyIndex:function(a,c){if(c===i)return b(this.vertexKeyIndex,this.graph.getVertices(),a);if(c===h)return b(this.edgeKeyIndex,this.graph.getEdges(),a);throw{message:"Invalid type"}},getIndex:function(a,b){var d=this.indices[a];if(c.isUndefined(d))return null;if(b!==d.getIndexType())throw{message:"Invalid index type"};return d},getIndices:function(){return c.values(this.indices)},getIndexedKeys:function(a){return this._getKeyIndex(a).getIndexedKeys()},dropIndex:function(a){delete this.indices[a]},dropKeyIndex:function(a,b){this._getKeyIndex(b).removeKey(a)},removeElement:function(a){for(var b=c.values(this.indices),d=0;d<b.length;d++){var e=b[d];c.isOfType(a,e.getIndexType())&&e.removeElement(a)}this._getKeyIndex(a.constructor).removeElement(a)},updateKeyIndexValue:function(a,b,c,d){this._getKeyIndex(d.constructor).update(a,b,c,d)},removeKeyIndexValue:function(a,b,c){this._getKeyIndex(c.constructor).remove(a,b,c)},fetchFirstMatching:function(a,b){for(var d=this.getIndexedKeys(a),e=0;e<b.length;e++){var f=b[e];if(f.predicate===n.EQUAL&&c.indexOf(f.key,d)>-1)return this._getKeyIndex(a).get(f.key,f.value)}return null},_getKeyIndex:function(a){if(a===i)return this.vertexKeyIndex;if(a===h)return this.edgeKeyIndex;throw{message:"Invalid type"}}}),a}(),m=function(){function a(){this.labels=c.convertVarArgs(arguments)}return c.mixin(a.prototype,{matches:function(a){for(var b=0;b<this.labels.length;b++)if(this.labels[b]===a.getLabel())return!0;return!1}}),a}(),n=function(){return{EQUAL:{evaluate:function(a,b){return a===b}},NOT_EQUAL:{evaluate:function(a,b){return a!==b}},GREATER_THAN:{evaluate:function(a,b){return null!==a&&null!==b&&a>b}},LESS_THAN:{evaluate:function(a,b){return null!==a&&null!==b&&b>a}},GREATER_THAN_EQUAL:{evaluate:function(a,b){return null!==a&&null!==b&&a>=b}},LESS_THAN_EQUAL:{evaluate:function(a,b){return null!==a&&null!==b&&b>=a}}}}();!function(){'use strict';return{IN:{evaluate:function(a,b){return c.checkArray("Second argument",b),c.indexOf(a,b)>-1}},NOT_IN:{evaluate:function(a,b){return c.checkArray("Second argument",b),-1===c.indexOf(a,b)}}}}();var o=function(){function a(a,b,d){c.checkExists("Key",a),c.checkExists("Predicate",b),this.key=a,this.value=d,this.predicate=b}return c.mixin(a.prototype,{matches:function(a){return this.predicate.evaluate(a.getProperty(this.key),this.value)}}),a}(),p=function(){function a(a,b,d,e){var f=0;c.isArray(a)||(a=[a]);for(var g=[],j=0;j<a.length;j++){var k=a[j];(c.isOfType(a[j],i)||c.isOfType(a[j],h))&&(k=[k]);for(var l in k){for(var m=k[l],n=!1,o=0;o<b.length;o++)if(!b[o].matches(m)){n=!0;break}if(!n){if(!(++f<=d))return g;e?g.push(e(m)):g.push(m)}}}return g}return{initQuery:function(){this.queryLimit=Number.MAX_VALUE,this.hasFilters=[]},limit:function(a){return this.queryLimit=a,this},has:function(a,b,d){return c.isUndefined(d)||null===d?c.isUndefined(b)||null===b?this.hasFilters.push(new o(a,n.NOT_EQUAL,null)):this.hasFilters.push(new o(a,n.EQUAL,b)):this.hasFilters.push(new o(a,b,d)),this},hasNot:function(a,b){return c.isUndefined(b)||null===b?this.hasFilters.push(new o(a,n.EQUAL,null)):this.hasFilters.push(new o(a,n.NOT_EQUAL,b)),this},interval:function(a,b,c){return this.hasFilters.push(new o(a,n.GREATER_THAN_EQUAL,b)),this.hasFilters.push(new o(a,n.LESS_THAN,c)),this},edges:function(){var b=this.getInitialEdges(),c=this.getBaseFilters();return c=c.concat(this.hasFilters),a(b,c,this.queryLimit)},vertices:function(){var b=this.getInitialVertices(),c=this.getBaseFilters();return c=c.concat(this.hasFilters),a(b,c,this.queryLimit,this.resultExtractor(this))}}}(),q=function(){function a(a){c.checkExists("Vertex",a),this.initQuery(),this.vertex=a,this.queryLabels=[],this.queryDirection=f}function b(a,b){var c=[];return a===e?c.push(b.inEdges):a===d?c.push(b.outEdges):(c.push(b.inEdges),c.push(b.outEdges)),c}return c.mixin(a.prototype,p),c.mixin(a.prototype,{direction:function(a){return c.checkInArray("direction",a,[e,d,f]),this.queryDirection=a,this},labels:function(){return this.queryLabels=c.convertVarArgs(arguments),this},getInitialEdges:function(){return b(this.queryDirection,this.vertex)},getInitialVertices:function(){return b(this.queryDirection,this.vertex)},getBaseFilters:function(){return this.queryLabels.length>0?[new m(this.queryLabels)]:[]},resultExtractor:function(a){return function(b){return a.queryDirection===e?b.getOutVertex():a.queryDirection===d?b.getInVertex():b.getOutVertex()===a.vertex?b.getInVertex():b.getOutVertex()}},count:function(){return this.edges().length}}),a}(),r=function(){function a(a){c.checkExists("Graph",a),this.initQuery(),this.graph=a}return c.mixin(a.prototype,p),c.mixin(a.prototype,{getInitialEdges:function(){var a=this.graph.indexManager.fetchFirstMatching(h,this.hasFilters);return a||(a=this.graph.edges),a},getInitialVertices:function(){var a=this.graph.indexManager.fetchFirstMatching(i,this.hasFilters);return a||(a=this.graph.vertices),a},getBaseFilters:function(){return[]},resultExtractor:function(){return function(a){return a}}}),a}();a.Edge=h,a.Vertex=i,a.Graph=j,a.VertexQuery=q,a.GraphQuery=q,a.Index=k,a.OUT=d,a.IN=e,a.BOTH=f}({},function(){return this}());