!function(a,b){'use strict';b.planar=a;var c={mixin:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},deepMixin:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},this.deepMixin(a[c],b[c])):a[c]=b[c]);return a},indexOf:function(a,b){if(a)for(var c=0;c<b.length;c++)if(b[c]===a)return c;return-1},indexOfById:function(a,b){if(a)for(var c=0;c<b.length;c++)if(b[c].id===a)return c;return-1},remove:function(a,b){var c=!1,d=this.indexOf(a,b);return d>=0&&(b.splice(d,1),c=!0),c},removeById:function(a,b){var c=!1,d=this.indexOfById(a,b);return d>=0&&(b.splice(d,1),c=!0),c},keys:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},select:function(a,b){var d=[];for(var e in a)a.hasOwnProperty(e)&&-1===c.indexOf(e,b)&&d.push(a[e]);return d},get:function(){var a=this.convertVarArgs(arguments),b=a[0];a.shift();for(var c=a,d=0;d<c.length;++d){if(this.isUndefined(b[c[d]]))return void 0;b=b[c[d]]}return b},values:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},isFunction:function(a){return"function"==typeof a},isUndefined:function(a){return"undefined"==typeof a},isArray:function(a){return"[object Array]"===Object.prototype.toString.apply(a)},isOfType:function(a,b){return a.constructor===b},checkExists:function(a,b){if(!c.exists(b))throw{message:a+" must be specified"}},exists:function(a){return!c.isUndefined(a)&&null!==a},checkInArray:function(a,b,c){if(this.checkExists(a,b),-1===this.indexOf(b,c))throw{message:a+" must be one of "+c}},checkArray:function(a,b){if(!this.isArray(b))throw{message:a+" must be an array"}},checkNotEmpty:function(a,b){if(""===b)throw{message:a+" must not be empty"}},checkArgument:function(a,b){if(!a)throw{message:b}},checkType:function(a,b,c){if(!this.isOfType(b,c))throw{message:a+" must be of type "+c}},generateId:function(){var a=1;return function(){return a++}}(),convertVarArgs:function(a){return a.length>0&&c.isArray(a[0])?a[0]:Array.prototype.slice.call(a)},randomInteger:function(a,b){return Math.floor(Math.random()*b)+a},randomDouble:function(a,b){return Math.random()*b+a}},d={isLeftOf:function(a,b){return a.x<b.x},isRightOf:function(a,b){return d.isLeftOf(a,b)},isAbove:function(a,b){return a.y<b.y},isBelow:function(a,b){return!d.isAbove(a,b)},centerOf:function(a){return new z(a.x+a.width/2,a.y+a.height/2)},gradient:function(a,b){return(b.y-a.y)/(b.x-a.x)},aspectRatio:function(a){return a.height/a.width},distanceOfPoints:function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},findIntersectionOnClosestSide:function(a,b){var c=d.centerOf(a),e=d.centerOf(b),f=d.gradient(c,e),g=d.aspectRatio(a),h=a.width/2,i=a.height/2,j=Math.abs(f/g),k=new z((d.isLeftOf(c,e)?1:-1)*h,(d.isAbove(c,e)?1:-1)*i);return 1>j?k.y*=j:k.x/=j,new z(c.x+k.x,c.y+k.y)},findClosestMidpointToIntersection:function(a,b,c,d){var e=c/2,f=d/2;return b.y-f===a.y?{point:new z(b.x,b.y-f),horizontal:!0}:f+b.y===a.y?{point:new z(b.x,b.y+f),horizontal:!0}:b.x-e===a.x?{point:new z(b.x-e,b.y),horizontal:!1}:e+b.x===a.x?{point:new z(b.x+e,b.y),horizontal:!1}:void 0}},e={widthOf:function(a){return a.g[0][0].getBBox().width},heightOf:function(a){return a.g[0][0].getBBox().height},getXYFromTranslate:function(a){var b=a.split(","),c=b[0]?b[0].split("(")[1]:0,d=b[1]?b[1].split(")")[0]:0;return[parseInt(c,10),parseInt(d,10)]}},f={traverse:function(a,b,c){for(b(a,c),a=a.firstChild;a;)this.traverse(a,b,c),a=a.nextSibling},convertImgToBase64:function(a,b,c){var d=document.createElement("CANVAS"),e=d.getContext("2d"),f=new Image;f.onload=function(){var a;d.height=f.height,d.width=f.width,e.drawImage(f,0,0),a=d.toDataURL(c),b(this,a),d=null},f.src=a},explicitlySetStyle:function(a,b,c){if(c=c||!1,!(a.nodeType!==window.Node.ELEMENT_NODE||b.indexOf(a.nodeName)>-1||c&&b.indexOf(a.parentNode.nodeName)>-1)){for(var d=getComputedStyle(a),e="",f=0;f<d.length;f++){var g=d[f];if("quotes"!==g){var h=d.getPropertyValue(g);e+=g+":"+h+";"}}a.setAttribute("style",e)}}},g=1,h=2,i=3,j="_type",k="and",l="or",m="vertex",n="edge",o="both",p=75,q=0,r=1,s=2,t=3,u="_id",v="_inV",w="_outV",x="_label",y=function(){return{on:function(a,b){c.checkExists("Event",a),c.checkExists("Callback",b),this.eventCallbacks=this.eventCallbacks||{},this.eventCallbacks[a]=this.eventCallbacks[a]||[],this.eventCallbacks[a].push(b)},off:function(a){c.checkExists("Event",a),this.eventCallbacks&&delete this.eventCallbacks[a]},trigger:function(a){c.checkExists("Event",a);var b,d,e;if(this.eventCallbacks&&this.eventCallbacks[a]){d=[].slice.call(arguments,1),b=this.eventCallbacks[a];for(var f=0;!e&&f<b.length;f++)e=b[f].apply(this,[a].concat(d))===!1}}}}(),z=function(a,b){return{x:a,y:b}},A=function(a,b,c,d){return{x:a,y:b,width:c,height:d}},B=function(){function a(a,b,c,d){for(var e=a.getPropertyFilters(b,d),f=0;f<e.length;f++)if(!e[f].isVisible(b,c))return!1;return!0}return{initProperties:function(a){this.properties=[],this.graph=a},setProperty:function(b,d){c.checkExists("Property key",b),c.checkExists("Property value",d),c.checkNotEmpty("Property key",b),a(this.graph,this,b,Array.prototype.splice.call(arguments,2))&&this.setPropertyUnfiltered(b,d)},setPropertyUnfiltered:function(a,b){c.checkExists("Property key",a),c.checkExists("Property value",b),c.checkNotEmpty("Property key",a);var d=this.properties[a];this.properties[a]=b,this.graph.indexManager.updateKeyIndexValue(a,b,d,this),this.graph.trigger("propertyUpdated",this,a,b,d)},getProperty:function(b){return a(this.graph,this,b,Array.prototype.splice.call(arguments,1))?this.getPropertyUnfiltered(b):null},getPropertyUnfiltered:function(a){return c.isUndefined(this.properties[a])?null:this.properties[a]},getPropertyKeys:function(){var b=[];for(var c in this.properties)this.properties.hasOwnProperty(c)&&a(this.graph,this,c,Array.prototype.slice.call(arguments))&&b.push(c);return b},getPropertyKeysUnfiltered:function(){return c.keys(this.properties)},removeProperty:function(b){return a(this.graph,this,b,Array.prototype.splice.call(arguments,1))?this.removePropertyUnfiltered(b):null},removePropertyUnfiltered:function(a){var b=this.getProperty(a);return delete this.properties[a],this.graph.indexManager.removeKeyIndexValue(a,b,this),this.graph.trigger("propertyRemoved",this,a,b),b},copyPropertiesTo:function(a){for(var b=this.getPropertyKeys(),c=0;c<b.length;c++){var d=b[c],e=this.getProperty(d);a.setProperty(d,e)}},getId:function(){return this.id},getGraph:function(){return this.graph}}}(),C=function(){function a(a,b,d,e,f){c.checkExists("ID",a),c.checkExists("Out vertex",b),c.checkExists("In vertex",d),this.id=a,this.outVertex=b,this.inVertex=d,this.label=e,this.initProperties(f)}return c.mixin(a.prototype,B),c.mixin(a.prototype,{getLabel:function(){return this.label},getInVertex:function(){return this.inVertex},getOutVertex:function(){return this.outVertex},getVertex:function(a){if(a===g)return this.outVertex;if(a===h)return this.inVertex;throw{message:"Invalid direction. Must be either IN or OUT"}},getOtherVertex:function(a){return this.inVertex.getId()===a.getId()?this.outVertex:this.inVertex},remove:function(){this.graph.removeEdge(this)},connects:function(a,b){return this.outVertex.id===a.id&&this.inVertex.id===b.id||this.outVertex.id===b.id&&this.inVertex.id===a.id}}),a}(),D=function(){function a(a,b){this.id=a,this.inEdges={},this.outEdges={},this.ui={},this.initProperties(b)}return c.mixin(a.prototype,B),c.mixin(a.prototype,{getEdges:function(a){var b=Array.prototype.slice.call(arguments,1);return new O(this).labels(b).direction(a).edges()},getVertices:function(a){var b=Array.prototype.slice.call(arguments,1);return new O(this).labels(b).direction(a).vertices()},addEdge:function(a,b){return this.graph.addEdge(null,this,b,a)},remove:function(){this.graph.removeVertex(this)},query:function(){return new O(this)}}),a}(),E=function(){function a(a){this.vertices={},this.edges={},this.indexManager=new H(this),this.vertexPropertyFilters={},this.edgePropertyFilters={},this.updateSettings(a)}return c.mixin(a.prototype,y),c.mixin(a.prototype,{addVertex:function(a){if(c.isUndefined(a)||null===a)for(a=c.generateId();null!==this.getVertex(a);)a=c.generateId();var b=this.getVertex(a);if(b)throw{message:"Vertex already exists with the given ID"};return b=new D(a,this),this.vertices[a]=b,this.trigger("vertexAdded",b),this.trigger("graphUpdated"),b},getVertex:function(a){return c.checkExists("ID",a),c.isUndefined(this.vertices[a])?null:this.vertices[a]},removeVertex:function(a){c.checkExists("Vertex",a);var b=this.getVertex(a.id);if(b){var d;for(d in b.inEdges)this.removeEdge(b.inEdges[d]);for(d in b.outEdges)this.removeEdge(b.outEdges[d]);this.indexManager.removeElement(b),delete this.vertices[b.id],this.trigger("vertexRemoved",b),this.trigger("graphUpdated")}},getVertices:function(a,b,d){return d=d||[],c.isUndefined(a)||null===a?c.values(this.vertices):new P(this).has(a,b,null,d).vertices()},addEdge:function(a,b,d,e){if(c.isUndefined(a)||null===a)for(a=c.generateId();null!==this.getEdge(a);)a=c.generateId();var f=new C(a,b,d,e,this);if(this.edges[a])throw{message:"Edge already exists with the given ID"};return this.edges[a]=f,b.outEdges[f.id]=f,d.inEdges[f.id]=f,this.trigger("edgeAdded",f),this.trigger("graphUpdated"),f},getEdge:function(a){return c.checkExists("ID",a),c.isUndefined(this.edges[a])?null:this.edges[a]},removeEdge:function(a){if(a){var b=this.edges[a.id];b&&(this.indexManager.removeElement(b),delete this.edges[b.id],delete b.outVertex.outEdges[b.id],delete b.inVertex.inEdges[b.id],this.trigger("edgeRemoved",a),this.trigger("graphUpdated"))}},getEdges:function(a,b,d){return c.isUndefined(a)||null===a?c.values(this.edges):new P(this).has(a,b,null,d).edges()},forEachVertex:function(a){if(c.isFunction(a))for(var b in this.vertices)if(a(this.vertices[b]))return},forEachEdge:function(a){if(c.isFunction(a))for(var b in this.edges)if(a(this.edges[b]))return},query:function(){return new P(this)},createIndex:function(a,b){return this.indexManager.createIndex(a,b)},getIndex:function(a,b){return this.indexManager.getIndex(a,b)},getIndices:function(){return this.indexManager.getIndices()},dropIndex:function(a){this.indexManager.dropIndex(a)},createKeyIndex:function(a,b){return this.indexManager.createKeyIndex(a,b)},getIndexedKeys:function(a){return this.indexManager.getIndexedKeys(a)},dropKeyIndex:function(a,b){this.indexManager.dropKeyIndex(a,b)},addVertexPropertyFilter:function(a,b){c.checkExists("Predicate name",a),c.checkExists("Predicate",b),this.vertexPropertyFilters[a]=b},addEdgePropertyFilter:function(a,b){c.checkExists("Predicate name",a),c.checkExists("Predicate",b),this.edgePropertyFilters[a]=b},getPropertyFilters:function(a,b){if(b=c.convertVarArgs(b),c.isOfType(a,D))return c.select(this.vertexPropertyFilters,b);if(c.isOfType(a,C))return c.select(this.edgePropertyFilters,b);throw"Invalid type"},removeAllVertexPropertyFilters:function(){this.vertexPropertyFilters={}},removeAllEdgePropertyFilters:function(){this.edgePropertyFilters={}},removeVertexPropertyFilter:function(a){c.checkExists("Predicate name",a),delete this.vertexPropertyFilters[a]},removeEdgePropertyFilter:function(a){c.checkExists("Predicate name",a),delete this.edgePropertyFilters[a]},filteredView:function(){return new Ca(this)},getSettings:function(){return this.settings},updateSettings:function(a){a=a||{},this.settings=c.mixin({},Ba),this.settings=c.deepMixin(this.settings,a)}}),a}(),F=function(){return{isVisible:function(a,b){return 0!==b.indexOf("_")}}}(),G=function(){function a(a,b){c.checkExists("Name",a),c.checkExists("Type",b),this.name=a,this.type=b,this.index={}}return c.mixin(a.prototype,{getIndexName:function(){return this.name},getIndexType:function(){return this.type},put:function(a,b,d){c.checkExists("Key",a),c.checkExists("Value",b),c.checkType("Element",d,this.type);var e=this.index[a]=this.index[a]||{},f=e[b]=e[b]||{};f[d.getId()]=d},putAll:function(a,b){c.checkExists("Key",a),c.checkArray("Elements",b);for(var d=0;d<b.length;d++){var e=b[d];c.checkType("Element "+d,e,this.type);var f=e.getProperty(a);f&&this.put(a,f,e)}},get:function(a,b){var d=this.index[a]||{},e=d[b]||{};return c.values(e)},count:function(a,b){return this.get(a,b).length},remove:function(a,b,d){c.checkType("Element",d,this.type);var e=this.index[a];if(e){var f=e[b];f&&delete f[d.getId()]}},removeElement:function(a){c.checkType("Element",a,this.type);for(var b in this.index){var d=this.index[b];if(d)for(var e in d)delete d[e][a.getId()]}},removeKey:function(a){delete this.index[a]},getIndexedKeys:function(){return c.keys(this.index)},update:function(a,b,d,e){c.indexOf(a,this.getIndexedKeys())>-1&&(c.isUndefined(d)||this.remove(a,d,e),this.put(a,b,e))}}),a}(),H=function(){function a(a){c.checkExists("Graph",a),this.graph=a,this.indices={},this.vertexKeyIndex=new G(name,D),this.edgeKeyIndex=new G(name,C)}function b(a,b,c){return a.removeKey(c),a.index[c]={},a.putAll(c,b),a}return c.mixin(a.prototype,{createIndex:function(a,b){if(c.checkExists("Name",a),c.checkExists("Type",b),this.indices.hasOwnProperty(a))throw{message:"Index already exists"};var d=new G(a,b);return this.indices[a]=d,d},createKeyIndex:function(a,c){if(c===D)return b(this.vertexKeyIndex,this.graph.getVertices(),a);if(c===C)return b(this.edgeKeyIndex,this.graph.getEdges(),a);throw{message:"Invalid type"}},getIndex:function(a,b){var d=this.indices[a];if(c.isUndefined(d))return null;if(b!==d.getIndexType())throw{message:"Invalid index type"};return d},getIndices:function(){return c.values(this.indices)},getIndexedKeys:function(a){return this._getKeyIndex(a).getIndexedKeys()},dropIndex:function(a){delete this.indices[a]},dropKeyIndex:function(a,b){this._getKeyIndex(b).removeKey(a)},removeElement:function(a){for(var b=c.values(this.indices),d=0;d<b.length;d++){var e=b[d];c.isOfType(a,e.getIndexType())&&e.removeElement(a)}this._getKeyIndex(a.constructor).removeElement(a)},updateKeyIndexValue:function(a,b,c,d){this._getKeyIndex(d.constructor).update(a,b,c,d)},removeKeyIndexValue:function(a,b,c){this._getKeyIndex(c.constructor).remove(a,b,c)},fetchFirstMatching:function(a,b){for(var d=this.getIndexedKeys(a),e=0;e<b.length;e++){var f=b[e];if(f.predicate===L.EQUAL&&c.indexOf(f.key,d)>-1)return this._getKeyIndex(a).get(f.key,f.value)}return null},_getKeyIndex:function(a){if(a===D)return this.vertexKeyIndex;if(a===C)return this.edgeKeyIndex;throw{message:"Invalid type"}}}),a}(),I=function(){function a(a,b,d,e){c.checkExists("Key",a),c.checkExists("Predicate",b),this.key=a,this.predicate=b,this.value=d,this.disabledFilters=e}return c.mixin(a.prototype,{matches:function(a){return this.predicate.evaluate(a.getProperty(this.key,this.disabledFilters),this.value)}}),a}(),J=function(){function a(){this.labels=c.convertVarArgs(arguments)}return c.mixin(a.prototype,{matches:function(a){for(var b=0;b<this.labels.length;b++)if(this.labels[b]===a.getLabel())return!0;return!1}}),a}(),K=function(){return{initHasConditions:function(){this.hasConditions=[]},has:function(a,b,d,e){return e=e||[],this.hasConditions.push(c.isUndefined(d)||null===d?c.isUndefined(b)||null===b?new I(a,L.NOT_EQUAL,null,e):new I(a,L.EQUAL,b,e):new I(a,b,d,e)),this},hasNot:function(a,b,d){return d=d||[],this.hasConditions.push(c.isUndefined(b)||null===b?new I(a,L.EQUAL,null,d):new I(a,L.NOT_EQUAL,b,d)),this},interval:function(a,b,c,d){return d=d||[],this.hasConditions.push(new I(a,L.GREATER_THAN_EQUAL,b,d)),this.hasConditions.push(new I(a,L.LESS_THAN,c,d)),this}}}(),L=function(){return{EQUAL:{evaluate:function(a,b){return a===b},displayName:"Equal to"},NOT_EQUAL:{evaluate:function(a,b){return a!==b},displayName:"Not equal to"},GREATER_THAN:{evaluate:function(a,b){return null!==a&&null!==b&&a>b},displayName:"Greater than"},LESS_THAN:{evaluate:function(a,b){return null!==a&&null!==b&&b>a},displayName:"Less than"},GREATER_THAN_EQUAL:{evaluate:function(a,b){return null!==a&&null!==b&&a>=b},displayName:"Greater than or equal to"},LESS_THAN_EQUAL:{evaluate:function(a,b){return null!==a&&null!==b&&b>=a},displayName:"Less than or equal to"}}}(),M=function(){return{IN:{evaluate:function(a,b){return c.checkArray("Second argument",b),c.indexOf(a,b)>-1}},HAS_ELEMENT:{evaluate:function(a,b){return c.checkArray("First argument",a),c.indexOf(b,a)>-1}},NOT_IN:{evaluate:function(a,b){return c.checkArray("Second argument",b),-1===c.indexOf(a,b)}}}}(),N=function(){function a(a,b,d,e){var f=0;c.isArray(a)||(a=[a]);for(var g=[],h=0;h<a.length;h++){var i=a[h];(c.isOfType(a[h],D)||c.isOfType(a[h],C))&&(i=[i]);for(var j in i){for(var k=i[j],l=!1,m=0;m<b.length;m++)if(!b[m].matches(k)){l=!0;break}if(!l){if(!(++f<=d))return g;g.push(e?e(k):k)}}}return g}return c.mixin({initQuery:function(){this.queryLimit=Number.MAX_VALUE,this.initHasConditions()},limit:function(a){return this.queryLimit=a,this},edges:function(){var b=this.getInitialEdges(),c=this.getBaseFilters();return c=c.concat(this.hasConditions),a(b,c,this.queryLimit)},vertices:function(){var b=this.getInitialVertices(),c=this.getBaseFilters();return c=c.concat(this.hasConditions),a(b,c,this.queryLimit,this.resultExtractor(this))}},K)}(),O=function(){function a(a){c.checkExists("Vertex",a),this.initQuery(),this.vertex=a,this.queryLabels=[],this.queryDirection=i}function b(a,b){var c=[];return a===h?c.push(b.inEdges):a===g?c.push(b.outEdges):(c.push(b.inEdges),c.push(b.outEdges)),c}return c.mixin(a.prototype,N),c.mixin(a.prototype,{direction:function(a){return c.checkInArray("direction",a,[h,g,i]),this.queryDirection=a,this},labels:function(){return this.queryLabels=c.convertVarArgs(arguments),this},getInitialEdges:function(){return b(this.queryDirection,this.vertex)},getInitialVertices:function(){return b(this.queryDirection,this.vertex)},getBaseFilters:function(){return this.queryLabels.length>0?[new J(this.queryLabels)]:[]},resultExtractor:function(a){return function(b){return a.queryDirection===h?b.getOutVertex():a.queryDirection===g?b.getInVertex():b.getOutVertex()===a.vertex?b.getInVertex():b.getOutVertex()}},count:function(){return this.edges().length}}),a}(),P=function(){function a(a){c.checkExists("Graph",a),this.initQuery(),this.graph=a}return c.mixin(a.prototype,N),c.mixin(a.prototype,{getInitialEdges:function(){var a=this.graph.indexManager.fetchFirstMatching(C,this.hasConditions);return a||(a=this.graph.edges),a},getInitialVertices:function(){var a=this.graph.indexManager.fetchFirstMatching(D,this.hasConditions);return a||(a=this.graph.vertices),a},getBaseFilters:function(){return[]},resultExtractor:function(){return function(a){return a}}}),a}(),Q=function(){function a(a,b){c.checkExists("Callback",a),this.callback=a,this.scope=b;var d,e=function(){d=window.requestAnimationFrame(e),a.apply(b)},f=function(){window.cancelAnimationFrame(d)};return{start:e,stop:f}}for(var b=0,d=["ms","moz","webkit","o"],e=0;e<d.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[d[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d[e]+"CancelAnimationFrame"]||window[d[e]+"CancelRequestAnimationFrame"];return window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var c=(new Date).getTime(),d=Math.max(0,16-(c-b)),e=window.setTimeout(function(){'use strict';a(c+d)},d);return b=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)}),a}(),R=function(){function a(a,b,c){this.width=0,this.padding=a||0,this.lineHeight=b||0,this.numberLines=c||0,this.heightWithPadding=b*c+2*a}return c.mixin(a.prototype,{addElement:function(a){var b=a.getBBox().width;this.width=b>this.width?b:this.width},leftEdge:function(){return-this.totalWidth()/2},rightEdge:function(){return this.totalWidth()/2},topEdge:function(){return-this.heightWithPadding/2},bottomEdge:function(){return this.heightWithPadding/2},totalWidth:function(){return this.width+2*this.padding},totalHeight:function(){return this.heightWithPadding}}),a}(),S=function(){function a(a,b){this.running=!0,this.tween=new pa(a,b),this.name="random"}var b=10,d=function(a,b,c){var d=a*b/(p*p*c);return d>1?1:d};return c.mixin(a.prototype,{step:function(e,f,g,h){var i=e.length;if(this.running){i=0;for(var j=d(g,h,e.length),k=g*(.5/j),l=h*(.5/j),m=0;m<e.length;m++){var n=e[m];n.started?(this.tween.runFrame(n,j),n.finished&&i++):(a.setBeginPoint(n,k,l),n.endX=c.randomInteger(0,g+1),n.endX=Math.max(n.endX,p/2+b),n.endX=Math.min(n.endX,g-p/2-b),n.endY=c.randomInteger(0,h+1),n.endY=Math.max(n.endY,p/2+b),n.endY=Math.min(n.endY,h-p/2-b),this.tween.start(n,j))}}return this.running&&i===e.length&&e.length>0&&e[0].vertex.getGraph().trigger("graphUpdated"),this.running=i<e.length,this.running}}),a.setBeginPoint=function(a,b,d){c.isUndefined(a.x)||c.isUndefined(a.y)?(a.beginX=b,a.beginY=d,a.x=b,a.y=d):(a.beginX=a.x,a.beginY=a.y)},a}(),T=function(){function a(){}return c.mixin(a.prototype,{step:function(){return!0}}),a}(),U=function(){return{decorateRenderer:function(a){this.elementRenderer=a,this.elementRenderer.asynch===!0&&(this.asynch=!0)},init:function(a,b){if(this.elementRenderer.asynch===!0){var c=this;this.elementRenderer.drawReadyCallback=function(){var a=c;return function(b,c){a.doInit(b,c),a.drawReadyCallback&&a.drawReadyCallback(b,c)}}(),this.elementRenderer.init(a,b)}else this.elementRenderer.init(a,b),this.doInit(a,b)},initDefs:function(a,b){this.elementRenderer.initDefs(a,b),this.doInitDefs(a,b)},updatePosition:function(a){this.elementRenderer.updatePosition(a),this.doUpdatePosition(a)},doInit:function(){},doInitDefs:function(){},doUpdatePosition:function(){}}}(),V=function(){function a(a){this.graph=a,b(this)}function b(a){var b=a.getSettings();c.checkExists("Container element",b.container),c.checkExists("Graphics engine",b.engine),a.renderer=new za(a,b),a.renderer.init()}return c.mixin(a.prototype,{addVertex:function(a){return this.graph.addVertex(a)},getVertex:function(a){return this.graph.getVertex(a)},removeVertex:function(a){this.graph.removeVertex(a)},getVertices:function(a,b,c){return this.graph.getVertices(a,b,c)},addEdge:function(a,b,c,d){return this.graph.addEdge(a,b,c,d)},getEdge:function(a){return this.graph.getEdge(a)},removeEdge:function(a){this.graph.removeEdge(a)},getEdges:function(a,b,c){return this.graph.getEdges(a,b,c)},forEachVertex:function(a){this.graph.forEachVertex(a)},forEachEdge:function(a){this.graph.forEachEdge(a)},query:function(){return this.graph.query()},createIndex:function(a,b){return this.graph.createIndex(a,b)},getIndex:function(a,b){return this.graph.getIndex(a,b)},getIndices:function(){return this.graph.getIndices()},dropIndex:function(a){this.graph.dropIndex(a)},createKeyIndex:function(a,b){return this.graph.createKeyIndex(a,b)},getIndexedKeys:function(a){return this.graph.getIndexedKeys(a)},dropKeyIndex:function(a,b){this.graph.dropKeyIndex(a,b)},addVertexPropertyFilter:function(a,b){this.graph.addVertexPropertyFilter(a,b)},addEdgePropertyFilter:function(a,b){this.graph.addEdgePropertyFilter(a,b)},getPropertyFilters:function(a,b){return this.graph.getPropertyFilters(a,b)},removeAllVertexPropertyFilters:function(){this.graph.removeAllVertexPropertyFilters()},removeAllEdgePropertyFilters:function(){this.graph.removeAllEdgePropertyFilters()},removeVertexPropertyFilter:function(a){this.graph.removeVertexPropertyFilter(a)},removeEdgePropertyFilter:function(a){this.graph.removeEdgePropertyFilter(a)},filteredView:function(){return this.graph.filteredView()},getSettings:function(){return this.graph.getSettings()},updateSettings:function(a){this.graph.updateSettings(a),b(this)},on:function(a,b){this.graph.on(a,b)},off:function(a){this.graph.off(a)},trigger:function(){this.graph.trigger(arguments)},render:function(){this.renderer.render()},saveAsImage:function(){this.renderer.saveAsImage()},destroy:function(){this.renderer.stop()},resize:function(){this.renderer.resize()},redraw:function(){this.renderer.redraw()},select:function(a){this.renderer.select(a)},setPosition:function(a,b,c){this.renderer.setPosition(a,b,c)}}),a}(),W=function(){function a(a){this.decorateRenderer(a)}return c.mixin(a.prototype,U),c.mixin(a.prototype,{doInit:function(a,b){var c=b.append("text").attr("id","text-of-label-"+a.edge.id).attr("x",10).attr("y",100).attr("alignment-baseline","central").attr("text-anchor","middle").attr("class","edge-label");c.append("tspan").attr("baseline-shift","super").text(a.edge.label)}}),a}(),X=function(){function a(a){this.decorateRenderer(a),this.doInit=function(a,b){var c=a.vertex,d=c.getGraph().getSettings(),e=c.getProperty(d.vertex.borderColorPropertyKey)||d.vertex.borderColor,f=c.getProperty(d.vertex.borderWeightPropertyKey)||d.vertex.borderWeight,g=c.getProperty(d.vertex.borderRadiusPropertyKey)||d.vertex.borderRadius,h=c.getProperty(d.vertex.borderPaddingPropertyKey)||d.vertex.borderPadding,i=b.node().getBBox();b.append("rect").attr("x",-i.width/2-h).attr("y",-i.height/2-h).attr("rx",g).attr("ry",g).attr("style","fill:none;stroke:"+e+";stroke-width:"+f+"px;").attr("width",i.width+2*h).attr("height",i.height+2*h)}}return c.mixin(a.prototype,U),a}(),Y=function(){function a(a){this.decorateRenderer(a)}function b(a,b,c,d){var f=e+2*d;return a.append("rect").attr("class","vertex-icon-overlay vertex-icon-overlay-"+b).attr("rx",c).attr("ry",c).attr("width",f).attr("height",f)}function d(a,b,c,d){var e=a.append("use").attr("class","vertex-icon vertex-icon-"+c).attr("transform","translate("+d+", "+d+")").attr("xlink:href","#"+b.id);return b.color&&e.attr("style","fill:"+b.color),e}var e=16;return c.mixin(a.prototype,U),c.mixin(a.prototype,{doInit:function(a,f){var g=a.vertex,h=g.getGraph(),i=h.getSettings(),j=g.getPropertyUnfiltered(i.vertex.icons.propertyKey),k=i.vertex.icons.horizontalMargin,l=i.vertex.icons.iconSetMargin,m=i.vertex.icons.iconPadding,n=i.vertex.icons.positioning,o=n===q||n===r,p=n===q||n===t,s=null,u=function(){return function(){s=(new Date).getTime()}},v=function(a){return function(){if(!d3.event.defaultPrevented){var b=(new Date).getTime();250>=b-s&&h.trigger("vertexIconClicked",g,a)}}};if(c.isArray(j))for(var w=f.node().getBBox(),x=w.width/2,y=w.height/2,z=e+2*m+k,A=e+2*m,B=p?-x:x-j.length*z,C=0;C<j.length;C++){var D=j[C],E=D.insideVertex||i.vertex.icons.insideVertex,F=D.borderRadius||i.vertex.icons.borderRadius,G=f.append("g").attr("class","vertex-icon-group");b(G,D.id,F,m),d(G,D,D.id,m);var H=B+C*z,I=o?-1:1,J=I*y;J+=o===E?l:-l-A,G.attr("transform","translate("+H+", "+J+")"),G.on("mousedown",u()),G.on("mouseup",v(D.id))}},doInitDefs:function(a,b){for(var c=0;c<b.icons.activeIcons.length;c++){var d=b.icons.activeIcons[c],e=b.icons.iconSet[d];if(!e)throw{message:"Could not find the specified icon in the icon set: "+d};a.append("path").attr("id",d).attr("d",e)}}}),a}(),Z=function(){function a(a,b){this.decorateRenderer(a),this.doInit=function(a,c){var d=c.node().getBBox(),e=d.height/2,f=b.padding;b.labelTop&&(e=-e,f=-f);var g=e;g+=b.labelInside?-f:f;var h=a.vertex.getProperty(b.labelPropertyKey);c.append("text").attr("class","custom-label").attr("text-anchor","middle").attr("y",g).text(h)}}return c.mixin(a.prototype,U),a}(),$=function(){return{init:function(a,b){c.checkExists("Container",a.container),c.checkExists("Graph",b),c.isFunction(this.initEngine)&&this.initEngine(a,b)},beforeRender:function(){},initVertex:function(){},renderVertex:function(){},stop:function(){},moveVertexToFront:function(){},vertexPropertyUpdated:function(){},edgePropertyUpdated:function(){},vertexPropertyRemoved:function(){},edgePropertyRemoved:function(){}}}(),_=function(){function a(a,b,c){this.svg=a,this.graph=b,this.svg.attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink"),this.imageVertices=this.svg.selectAll("image").size(),this.disablePanControl=c||!1,this.existingElementStyles=[]}function b(a){a.imageLoadedInterval=setInterval(d,100,a)}function d(a){if(0===a.imageVertices){var b=new XMLSerializer,c=b.serializeToString(a.svg.node()),d=new Image;d.onload=function(){var b=document.createElement("canvas");b.width=a.svg.attr("width"),b.height=a.svg.attr("height");var c=b.getContext("2d");c.drawImage(d,0,0);var e=document.createElement("a");e.download="image.png",e.href=b.toDataURL("image/png"),document.body.appendChild(e),e.click(),k(a),a.graph.trigger("downloadFinished")},d.onerror=function(){console.log("Failed to save image.")},d.src="data:image/svg+xml;base64,"+window.btoa(c),clearInterval(a.imageLoadedInterval)}}function e(a,b){g(a,b),i(a,b),f.explicitlySetStyle(a,["defs"],!0)}function g(a,b){if("image"===a.nodeName.toLowerCase()){var c=d3.select(a).attr("xlink:href");f.convertImgToBase64(c,function(c,d){d3.select(a).attr("xlink:href",d),h(b)},"image/png")}}function h(a){a.imageVertices--}function i(a,b){if(a.nodeType===window.Node.ELEMENT_NODE&&a.hasAttribute("style")){var c=Math.floor(1e5*Math.random()+1),d="has-style-"+a.tagName+"-"+c,e=a.getAttribute("class")+" "+d;a.setAttribute("class",e),a.setAttribute("className",e),b.existingElementStyles.push({id:d,style:a.getAttribute("style")})}}function j(a){a.disablePanControl&&d3.select("#zoomPanControl").attr("style","display:none;")}function k(a){a.svg.attr("style",null),a.svg.selectAll("*").attr("style",null);for(var b=0;b<a.existingElementStyles.length;b++){var c=a.existingElementStyles[b],d="."+c.id,e=d3.select(a.svg.node().parentNode).select(d);e.attr("style",c.style);var f=e.node().className.baseVal.split(" "),g=f.indexOf(c.id);f.splice(g,1);var h=f.join(" ");e.node().setAttribute("class",h),e.node().setAttribute("className",h)}d3.select("#zoomPanControl").attr("style","display:block;")}return c.mixin(a.prototype,{download:function(){this.graph.trigger("downloadStarted"),j(this),f.traverse(this.svg.node(),e,this),b(this)}}),a}(),aa=function(){function a(a,c,e,f){this.scale=e.zoom.defaultScale,this.translation=[0,0],this.xScale=b(e),this.yScale=d(e),this.svg=a,this.svgDefs=c,this.zoom=null,this.navigator=null,this.graphContainer=null,this.settings=e,this.graph=f}function b(a){return d3.scale.linear().domain([-a.width/2,a.width/2]).range([0,a.width])}function d(a){return d3.scale.linear().domain([-a.height/2,a.height/2]).range([a.height,0])}function e(a,b,d){if(!c.exists(b.navigatorContainer)||!b.navigator.enabled)return null;var e=d3.select(b.navigatorContainer).append("svg").attr("width",b.width*b.navigator.scale).attr("height",b.height*b.navigator.scale).attr("class","svg canvas");return new ca(e,a,d3.select("#panCanvas"),b,d)}function f(a,b,c,d){var e=new da(a,b,d3.select("#panCanvas"),c,d);e.render()}function g(a){a.svgDefs.append("clipPath").attr("id","wrapperClipPath").attr("class","wrapper clipPath").append("rect").attr("class","background").attr("width",a.settings.width).attr("height",a.settings.height);var b=a.svg.append("g").attr("id","outerWrapper").attr("class","wrapper outer");b.append("rect").attr("class","background").attr("width",a.settings.width).attr("height",a.settings.height);var c=b.append("g").attr("class","wrapper inner").attr("clip-path","url(#wrapperClipPath)").call(a.zoom);c.append("rect").attr("class","background").attr("width",a.settings.width).attr("height",a.settings.height);var d=c.append("g").attr("id","panCanvas").attr("class","panCanvas").attr("width",a.settings.width).attr("height",a.settings.height).attr("transform","translate(0,0)");d.append("rect").attr("class","background").attr("width",a.settings.width).attr("height",a.settings.height),a.graphContainer=d.append("g").attr("id","graphElements").attr("transform","scale("+a.scale+")")}return c.mixin(a.prototype,{init:function(){var a=this,b=function(){var b=a.settings;return function(c){if(b.zoom.enabled){if(a.scale=d3.event?d3.event.scale:c,b.drag.enabled){var d=-b.height*a.scale+b.height,e=0,f=-b.width*a.scale+b.width,g=0,h=d3.event&&1!==a.scale?d3.event.translate:[0,0];a.translation=[Math.max(Math.min(h[0],g),f),Math.max(Math.min(h[1],e),d)]}d3.select(".panCanvas, .panCanvas .bg").attr("transform","translate("+a.translation+") scale("+a.scale+")");

}}}();this.zoom=d3.behavior.zoom().x(this.xScale).y(this.yScale).scaleExtent([this.settings.zoom.minScale,this.settings.zoom.maxScale]).on("zoom.canvas",b),g(this),this.navigator=e(this.zoom,this.settings,this.graph),f(this.svg,this.zoom,this.settings,this.graph)},getZoom:function(){return this.zoom},getNavigator:function(){return this.navigator},getGraphContainer:function(){return this.graphContainer}}),a}(),ba=function(){function a(a,b){this.element=a,this.instanceSettings=b}return c.mixin(a.prototype,{addDragToVertices:function(){var a,b=d3.behavior.drag(),c=this.instanceSettings;b.origin(function(a){'use strict';return a}),b.on("dragstart",function(b){a=(new Date).valueOf(),d3.event.sourceEvent.stopPropagation();var c=b.vertex.getGraph();c.trigger("vertexDragStart",b)}),b.on("drag",function(b){var e=(new Date).valueOf();if(e-a>c.drag.delay){var f=b.g[0][0].getBBox(),g={x:b.x+f.x,y:b.y+f.y},h={x:b.x,y:b.y+f.y},i=d.distanceOfPoints(g,h),j=f.width-i,k=d.distanceOfPoints(b,h),l=f.height-k,m={x:d3.event.x+f.x,y:d3.event.y+f.y},n={x:m.x+f.width,y:m.y+f.height};b.x=m.x<=0?i:n.x>=c.width?c.width-j:d3.event.x,b.y=m.y<=0?k:n.y>=c.height?c.height-l:d3.event.y;var o=b.vertex.getGraph();o.trigger("vertexDrag",b)}}),b.on("dragend",function(a){var b=a.vertex.getGraph();b.trigger("vertexDragEnd",a)}),this.element.call(b)}}),a}(),ca=function(){function a(c,e,h,i,j){if(this.navigatorScale=i.navigator.scale,this.scale=1,this.zoom=e,this.target=h,this.width=i.width,this.height=i.height,this.frameX=0,this.frameY=0,this.renderNavigator=!0,this.graph=j,!b())return void(a.render=function(){});g(c,this.width,this.height),this.base=c,this.container=this.base.append("g").attr("class","navigator").attr("clip-path","url(#navigatorClipPath)").call(this.zoom);var k=this.container.append("g"),l=this;this.zoom.on("zoom.navigator",function(){l.scale=d3.event.scale}),this.node=k.node(),this.frame=k.append("g").attr("class","frame"),this.frame.append("rect").attr("class","background").attr("width",this.width).attr("height",this.height);var m=d3.behavior.drag().on("dragstart.navigator",function(){d(l)}).on("drag.navigator",function(){f(l)});this.frame.call(m),j.on("graphUpdated",function(){l.renderNavigator=!0}),j.on("vertexDrag",function(){l.renderNavigator=!0})}function b(){return Ba.zoom.enabled&&Ba.navigator.enabled}function d(a){var b=e.getXYFromTranslate(a.frame.attr("transform"));a.frameX=parseInt(b[0],10),a.frameY=parseInt(b[1],10)}function f(a){var b=0,c=a.height-a.height/a.scale,d=0,e=a.width-a.width/a.scale;d3.event.sourceEvent.stopImmediatePropagation(),a.frameX+=d3.event.dx,a.frameY+=d3.event.dy,a.frameX=Math.max(Math.min(a.frameX,e),d),a.frameY=Math.max(Math.min(a.frameY,c),b),a.frame.attr("transform","translate("+a.frameX+","+a.frameY+")");var f=[-a.frameX*a.scale,-a.frameY*a.scale];a.target.attr("transform","translate("+f+")scale("+a.scale+")"),a.zoom.translate(f)}function g(a,b,c){var d=a.append("defs");d.append("clipPath").attr("id","navigatorClipPath").attr("class","navigator clipPath").attr("width",b).attr("height",c).append("rect").attr("class","background").attr("width",b).attr("height",c)}return c.mixin(a.prototype,{render:function(){var a=e.getXYFromTranslate(this.target.attr("transform"));if(this.frame.attr("transform","translate("+-a[0]/this.scale+","+-a[1]/this.scale+")").select(".background").attr("width",this.width/this.scale).attr("height",this.height/this.scale),this.renderNavigator){this.scale=this.zoom.scale(),this.container.attr("transform","scale("+this.navigatorScale+")");var b=this.target.node().cloneNode(!0);b.removeAttribute("id"),d3.selectAll(".navigator .panCanvas").remove(),this.base.selectAll(".navigator .canvas").remove(),this.node.appendChild(b),this.frame.node().parentNode.appendChild(this.frame.node()),d3.select(b).attr("transform","translate(1,1)"),this.renderNavigator=!1}}}),a}(),da=function(){function a(a,c,d,e,f){this.base=a,this.width=e.width,this.height=e.height,this.zoom=c,this.target=d,this.zoomScale=e.zoomPanControl.zoomStep,this.panScale=e.zoomPanControl.panStep,this.x=e.zoomPanControl.paddingLeft,this.y=e.zoomPanControl.paddingTop,this.graph=f;var g=this;this.graph.on("graphZoomOut",function(){b(g,-7)})}function b(a,b){var c=e.getXYFromTranslate(a.target.attr("transform")),d=a.zoom.scale(),f=d+b,g={w:a.width*d,h:a.height*d},h={w:a.width*f,h:a.height*f},i=(g.w-h.w)/2,j=(g.h-h.h)/2,k=[i+c[0],j+c[1]];f=Math.min(a.zoom.scaleExtent()[1],Math.max(a.zoom.scaleExtent()[0],f));var l=-a.height*f+a.height,m=0,n=-a.width*f+a.width,o=0,p=[Math.max(Math.min(k[0],o),n),Math.max(Math.min(k[1],m),l)];a.target.attr("transform","translate("+p+")scale("+f+")"),a.zoom.translate(p).scale(f)}function d(a,b){var c=a.zoom.scale(),d=-a.height*c+a.height,f=0,g=-a.width*c+a.width,h=0,i=e.getXYFromTranslate(a.target.attr("transform")),j=i[0],k=i[1];j+=b.x,k+=b.y,j=Math.max(Math.min(j,h),g),k=Math.max(Math.min(k,f),d),a.target.attr("transform","translate("+[j,k]+")scale("+c+")"),a.zoom.translate([j,k])}return c.mixin(a.prototype,{render:function(){if(Ba.zoomPanControl.enabled){var a=this.base.append("g").attr("id","zoomPanControl");a.append("circle").attr("class","wrapperCircle").attr("cx",50).attr("cy",50).attr("r",42),a.append("path").attr("id","panUp").attr("class","zoomPanButton").attr("d","M50 10 l12   20 a40, 70 0 0,0 -24,  0z"),a.append("path").attr("id","panLeft").attr("class","zoomPanButton").attr("d","M10 50 l20  -12 a70, 40 0 0,0   0, 24z"),a.append("path").attr("id","panDown").attr("class","zoomPanButton").attr("d","M50 90 l12  -20 a40, 70 0 0,1 -24,  0z"),a.append("path").attr("id","panRight").attr("class","zoomPanButton").attr("d","M90 50 l-20 -12 a70, 40 0 0,1   0, 24z"),a.append("circle").attr("class","compass").attr("cx",50).attr("cy",50).attr("r",20),a.append("circle").attr("id","zoomOut").attr("class","zoomPanButton").attr("cx",50).attr("cy",41).attr("r",8),a.append("circle").attr("id","zoomIn").attr("class","zoomPanButton").attr("cx",50).attr("cy",59).attr("r",8),a.append("rect").attr("class","plus-minus").attr("x",46).attr("y",39.5).attr("width",8).attr("height",3),a.append("rect").attr("class","plus-minus").attr("x",46).attr("y",57.5).attr("width",8).attr("height",3),a.append("rect").attr("class","plus-minus").attr("x",48.5).attr("y",55).attr("width",3).attr("height",8),a.attr("transform","translate("+this.x+","+this.y+")");var c=this;d3.select("#panUp").on("click",function(){d(c,{x:0,y:c.panScale})}),d3.select("#panDown").on("click",function(){d(c,{x:0,y:-c.panScale})}),d3.select("#panLeft").on("click",function(){d(c,{x:c.panScale,y:0})}),d3.select("#panRight").on("click",function(){d(c,{x:-c.panScale,y:0})}),d3.select("#zoomIn").on("click",function(){b(c,c.zoomScale)}),d3.select("#zoomOut").on("click",function(){b(c,-c.zoomScale)})}}}),a}(),ea=function(){function a(){}function b(a,b,c){return a.selectAll("."+b).data(c,function(a){return a.id})}function d(a,b){var c=b.enter().append("g");return c.attr("class",function(b){var c=b[a].getPropertyUnfiltered(j),d=a;return c&&(d+=" "+c),d}),c.each(function(b){'use strict';var c=oa.getRenderer(b[a],"d3",a);b.g=d3.select(this),c.init(b,b.g)}),c.on("click",function(b){if(!d3.event.defaultPrevented){var c=b[a].getGraph();c.trigger(a+"Clicked",b)}}),b.exit().remove(),c}function e(a){a.attr("transform",function(a){return a.x=a.x||0,a.y=a.y||0,"translate("+a.x+","+a.y+")"})}function f(a){a.each(function(a){'use strict';var b=oa.getRenderer(a.edge,"d3","edge");b.updatePosition(a)})}return c.mixin(a.prototype,$),c.mixin(a.prototype,{initEngine:function(a,b){this.graph=b,this.settings=a;var c=this.svg=d3.select(a.container).append("svg").attr("id","graph-canvas").attr("class","svg canvas").attr("width",a.width).attr("height",a.height);c.append("rect").attr("class","overlay").attr("width",a.width).attr("height",a.height);var d=c.append("defs");this.zoomPanManager=new aa(c,d,a,b),this.zoomPanManager.init();for(var e=oa.getAll("d3",a),f=0;f<e.length;f++)"function"==typeof e[f].initDefs&&e[f].initDefs(d,a)},beforeRender:function(a,c){var g=b(this.zoomPanManager.getGraphContainer(),"edge",c);d("edge",g);var h=b(this.zoomPanManager.getGraphContainer(),"vertex",a),i=d("vertex",h);e(h);var j=new ba(i,this.settings);j.addDragToVertices(),f(g);var k=this.zoomPanManager.getNavigator();null!==k&&k.render()},saveAsImage:function(){var a=new _(d3.select("#graph-canvas"),this.graph,!0);a.download()},stop:function(){d3.select(this.settings.container).selectAll("*").remove(),d3.select(this.settings.navigatorContainer).selectAll("*").remove()},moveVertexToFront:function(a){var b=a.node();b.parentNode.appendChild(b)},vertexPropertyUpdated:function(a){a.g&&a.g.remove()},vertexPropertyRemoved:function(a){a.g&&a.g.remove()}}),a}(),fa=function(){function a(){}return c.mixin(a.prototype,{init:function(a,b){var c=a.edge,d=c.getGraph().getSettings(),e=c.getProperty(d.edge.lineWeightPropertyKey)||d.edge.defaultLineWeight,f=d.edge.useArrows?"url(#arrow)":"";a.uiElement=b.append("path").attr("id","edgeLabel").attr("class","directed-edge arrow").attr("marker-end",f).attr("style","stroke-width: "+e+"px;")},initDefs:function(a){a.append("marker").attr("id","arrow").attr("refX",10).attr("refY",2).attr("markerWidth",10).attr("markerHeight",4).attr("orient","auto").append("path").attr("d","M0,0L10,2L0,4")},updatePosition:function(a){var b=a.uiElement,c=new ga(a),d=c.calculate();d3.select("#text-of-label-"+a.id).attr("x",d.labelPosition.x),d3.select("#text-of-label-"+a.id).attr("y",d.labelPosition.y),b.attr("id","edgeLabel"+a.id),b.attr("d","M"+d.startPoint.x+","+d.startPoint.y+"A "+d.radiusX+" "+d.radiusY+" "+d.xAxisRotation+" 0 "+d.sweepFlag+" "+d.endPoint.x+" "+d.endPoint.y)}}),a}(),ga=function(){function a(a){this.edge=a}var b=function(a,b,c){var d=25e3/c;d=Math.min(d,105),d=Math.max(d,55);var e=(b-1)*d,f=e/2;return Math.abs(-f+a*d)},f=function(a,b){var c=b.uiElement,e=c[0][0].getBBox().width,f=c[0][0].getBBox().height;return d.findClosestMidpointToIntersection(a,b,e,f)},g=function(a){for(var b=a.inVertex.vertex.getEdges(i),c=0,d=0,e=0;e<b.length;e++)b[e].connects(a.outVertex,a.inVertex)&&(a.id<b[e].id&&c++,d++);return{indexOfCurrentEdge:c,siblingEdges:d}},h=function(a,b,c,d,e){var f=a/1.75*d,g=a/1.75*e;return f=c?-f:f,g=c?-g:g,{x:b.x+f,y:b.y-g}};return c.mixin(a.prototype,{calculate:function(){var a=e.widthOf(this.edge.inVertex),c=e.heightOf(this.edge.inVertex),i=e.widthOf(this.edge.outVertex),j=e.heightOf(this.edge.outVertex),k=new A(this.edge.inVertex.x-a/2,this.edge.inVertex.y-c/2,a,c),l=new A(this.edge.outVertex.x-i/2,this.edge.outVertex.y-j/2,i,j),m=d.findIntersectionOnClosestSide(l,k),n=d.findIntersectionOnClosestSide(k,l),o=f(n,this.edge.inVertex),p=f(m,this.edge.outVertex),q=d.distanceOfPoints(o.point,p.point),r=g(this.edge),s=b(r.indexOfCurrentEdge,r.siblingEdges,q),t=r.indexOfCurrentEdge<r.siblingEdges/2,u=d.isAbove(o.point,p.point),v=d.isLeftOf(o.point,p.point),w=this.edge.inVertex.id>this.edge.outVertex.id?this.edge.inVertex:this.edge.outVertex,x=this.edge.inVertex===w,y=this.edge.inVertex.id>this.edge.outVertex.id?o.point:p.point,B=this.edge.inVertex.id>this.edge.outVertex.id?p.point:o.point,C=Math.abs(o.point.y-p.point.y)/q,D=180*Math.asin(C)/Math.PI,E=(y.y-B.y)/q,F=(y.x-B.x)/q,G=new z((o.point.x+p.point.x)/2,(o.point.y+p.point.y)/2);return{startPoint:{x:p.point.x,y:p.point.y},endPoint:{x:o.point.x,y:o.point.y},labelPosition:h(s,G,t,E,F),radiusX:.55*q,radiusY:s,xAxisRotation:u===v?D:-D,sweepFlag:x!==t?1:0}}}),a}(),ha=function(){function a(){}return c.mixin(a.prototype,{init:function(a,b){var c=a.edge,d=c.getGraph().getSettings(),e=c.getProperty(d.edge.lineWeightPropertyKey)||d.edge.defaultLineWeight;a.uiElement=b.append("line").attr("style","stroke-width: "+e+"px;")},initDefs:function(){},updatePosition:function(a){var b=a.uiElement;b.attr("x1",function(a){return a.inVertex.x}),b.attr("y1",function(a){return a.inVertex.y}),b.attr("x2",function(a){return a.outVertex.x}),b.attr("y2",function(a){return a.outVertex.y})}}),a}(),ia=function(){function a(){this.asynch=!0}return c.mixin(a.prototype,{init:function(a,b){var c=a.vertex;a.uiElement=b;var d=c.getGraph().getSettings(),e=c.getProperty(d.vertex.imageUrlPropertyKey),f=b.append("svg:image").attr("xlink:href",e),g=this,h=new Image;h.src=e,h.onload=function(){var d=this.width,e=this.height;f.attr("width",d).attr("height",e).attr("x",-d/2).attr("y",-e/2),c.getGraph().trigger("graphUpdated"),g.drawReadyCallback(a,b)}},initDefs:function(){}}),a}(),ja=function(){function a(){}return c.mixin(a.prototype,{init:function(a,b){var c=a.vertex,d=c.getPropertyUnfiltered("_queryVertexReference"),e=c.getPropertyUnfiltered("entityType"),f=25,g=10,h=c.getPropertyKeys(),i=h.length+1,j=-(i*f)/2+f/2,k=new R(g,f,i);a.uiElement=b;var l=b.append("g").attr("class","query-result-vertex-header"),m=l.append("text").attr("class","entity-type-label").attr("text-anchor","start").attr("y",j).text(e),n=l.append("text").attr("class","query-vertex-ref-label").attr("text-anchor","end").attr("y",j).text(d),o=16,p=l.append("use").attr("xlink:href","#icon-zoomin").attr("y",j-o+2);k.addElement(l[0][0]);for(var q=0;q<h.length;q++){var r=h[q],s=c.getProperty(r);j+=f;var t=b.append("text").attr("text-anchor","middle").attr("x",0).attr("y",j);t.append("tspan").attr("class","property-name-label").text(r+": "),t.append("tspan").text(s),k.addElement(t[0][0])}var u,v,w=5,x=k.totalWidth(),y=l[0][0].getBBox().width+5*g,z=k.totalHeight(),A=-(z/2-f)+w;x>y?(u=k.leftEdge(),v=k.rightEdge()):(x=y,u=-x/2,v=x/2),n.attr("x",v-g-o-4),m.attr("x",u+g),p.attr("x",v-g-o),b.append("line").attr("class","divider").attr("x1",u).attr("y1",A).attr("x2",v).attr("y2",A),b.insert("rect",".query-result-vertex-header").attr("class","query-vertex-box").attr("rx","4").attr("width",x).attr("height",z).attr("x",u).attr("y",k.topEdge())},initDefs:function(a){var b=a.append("linearGradient").attr("id","queryResultVertexDefaultFillScheme").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");b.append("stop").attr("offset","0%").attr("stop-color","#f9f9f9").attr("stop-opacity","1"),b.append("stop").attr("offset","100%").attr("stop-color","#edebf4").attr("stop-opacity","1");var c=a.append("g").attr("id","icon-zoomin");c.append("path").attr("d","M15.504 13.616l-3.79-3.223c-0.392-0.353-0.811-0.514-1.149-0.499 0.895-1.048 1.435-2.407 1.435-3.893 0-3.314-2.686-6-6-6-3.314 0-6 2.686-6 6 0 3.314 2.686 6 6 6 1.486 0 2.845-0.54 3.893-1.435-0.016 0.338 0.146 0.757 0.499 1.149l3.223 3.79c0.552 0.613 1.453 0.665 2.003 0.115s0.498-1.452-0.115-2.003zM6 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4zM7 3h-2v2h-2v2h2v2h2v-2h2v-2h-2z")}}),a}(),ka=function(){function a(a){c.checkExists("Type",a),this.type=a}return c.mixin(a.prototype,{init:function(a,b){var c=b.append("path");c.attr("d",d3.svg.symbol().type(this.type).size(200)),a.uiElement=c},initDefs:function(){}}),a}(),la=function(){function a(a){c.checkExists("Query Graph",a),this.queryGraph=a}return c.mixin(a.prototype,{isVisible:function(a,b){return"entityType"===b?!1:!0}}),a}(),ma=function(){function a(){}return c.mixin(a.prototype,$),c.mixin(a.prototype,{initEngine:function(a,b,c,d){this.paper=new Raphael(a,c,d)},initVertex:function(a){var b=oa.getVertexRenderer(a,"raphael");c.checkExists("Renderer",b),b.init(a,this.paper)},renderVertex:function(a){var b=oa.getVertexRenderer(a,"raphael");c.checkExists("Renderer",b),b.render(a,this.paper)}}),a}(),na=function(){return{init:function(a,b){a.ui.element=b.rect(0,0,60,40,10)},render:function(a){a.ui.element.attr(a.ui.position)}}}(),oa=function(){return{getRenderer:function(a,b,d){var e,f=a.getGraph().getSettings(),g=a.getPropertyUnfiltered(j);return null!==g&&(e=c.get(f,b,"vertex"===d?"vertexRenderers":"edgeRenderers",g)),c.isUndefined(e)&&(e=c.get(f,b,"vertex"===d?"defaultVertexRenderer":"defaultEdgeRenderer")),e},getAll:function(a,b){var d=c.get(b,a),e=c.values(d.vertexRenderers);return e=e.concat(c.values(d.edgeRenderers))},getVertexRenderer:function(a,b){return this.getRenderer(a,b,"vertex")},getEdgeRenderer:function(a,b){return this.getRenderer(a,b,"edge")}}}(),pa=function(){function a(a,b){this.duration=a,this.easing=b}var b=function(b,c){var d=a.dateNow();b.currentTime=b.endTime-d,b.state=b.currentTime/c,b.state<0&&(b.state=0)};return c.mixin(a.prototype,{start:function(b,c){b.state=1,b.startTime=a.dateNow(),b.endTime=b.startTime+this.duration,b.started=!0,this.runFrame(b,c)},runFrame:function(a,c){b(a,this.duration),a.x=this.easing(a.currentTime,a.endX,a.beginX-a.endX,this.duration),a.y=this.easing(a.currentTime,a.endY,a.beginY-a.endY,this.duration),xa.setScale(this.easing(a.currentTime,c,xa.getScale()-c,this.duration)),0===a.state&&(a.finished=!0)}}),a.dateNow=function(){return(new Date).getTime()},a}(),qa=function(){function a(a,b,c){this.running=!0,this.tween=new pa(a,b),this.ignoreVertex=c,this.name="circle"}a.MIN_RADIUS=100;var b=function(b){var c=19*b;return c<a.MIN_RADIUS?a.MIN_RADIUS:c},d=function(a,b,c){var d=c>b?b/2:c/2,e=d/(a+75);return e>1?1:e};return c.mixin(a.prototype,{step:function(e,f,g,h,i){var j=e.length;if(this.running){j=0,(c.isUndefined(this.ignoreVertex)||!this.ignoreVertex)&&(i=void 0);for(var k=c.isUndefined(i)?e.length:e.length-1,l=b(k),m=d(l,g,h),n=g*(.5/m),o=h*(.5/m),p=0,q=0;q<e.length;q++){var r=e[q];if(r.started)this.tween.runFrame(r,m),r.finished&&j++;else{if(a.setBeginPoint(r,n,o),c.isUndefined(i)||i.id!==r.id){var s=2*Math.PI*p++/k;r.endX=Math.cos(s)*l+n,r.endY=Math.sin(s)*l+o}else r.endX=n,r.endY=o;this.tween.start(r,m)}}}return this.running&&j===e.length&&e.length>0&&e[0].vertex.getGraph().trigger("graphUpdated"),this.running=j<e.length,this.running}}),a.setBeginPoint=function(a,b,d){c.isUndefined(a.x)||c.isUndefined(a.y)?(a.beginX=b,a.beginY=d,a.x=a.beginX,a.y=a.beginY):(a.beginX=a.x,a.beginY=a.y)},a}(),ra=function(){function a(a,b){this.running=!0,this.circleLayout=new qa(a,b,!0),this.name="wheel"}return c.mixin(a.prototype,{step:function(a,b,d,e,f){if(this.running){var g=f;a.length>0&&c.isUndefined(f)&&(g=a[0]),this.running=this.circleLayout.step(a,b,d,e,g)}return this.running}}),a}(),sa=function(){function a(a,b){this.running=!0,this.tween=new pa(a,b),this.name="grid"}var b=function(a,b,c,d){var e=1===d?1:a/((d-1)*(a/(d-1)+p)),f=1===c?1:b/((c-1)*(b/(c-1)+p)),g=Math.min(e,f);return g>1?1:g};return c.mixin(a.prototype,{step:function(c,d,e,f){var g=c.length;if(this.running){g=0;for(var h=c.length,i=Math.floor(Math.sqrt(h)),j=0===i?0:Math.floor(h/i)+1,k=f-p,l=e-2*p,m=b(l,k,i,j),n=2*p/m,o=p,q=0;q<c.length;q++){var r=c[q];r.started?(this.tween.runFrame(r,m),r.finished&&g++):(a.setBeginPoint(r,n,o),r.endX=n+l*(q%j/j)+q%j*p,r.endY=o+k*(Math.floor(q/j)/i)+Math.floor(q/j)*p,this.tween.start(r,m))}}return this.running&&g===c.length&&c.length>0&&c[0].vertex.getGraph().trigger("graphUpdated"),this.running=g<c.length,this.running}}),a.setBeginPoint=function(a,b,d){c.isUndefined(a.x)||c.isUndefined(a.y)?(a.beginX=b,a.beginY=d,a.x=b,a.y=d):(a.beginX=a.x,a.beginY=a.y)},a}(),ta=function(){function a(a,b){this.running=!0,this.tween=new pa(a,b),this.maxX=0,this.maxY=0,this.maxDepth=0,this.name="tree"}a.SIBLING_NODE_DISTANCE=5,a.SUBTREE_DISTANCE=25,a.DEPTH_DISTANCE=125,a.PADDING=75;var b=function(a,b){var c=[],d=[];for(c.push(a),d.push(a.id);c.length>0;){var e=c[0];c.splice(0,1),e.children=[];for(var f=e.vertex.getEdges(i),g=0;g<f.length;g++){var h=f[g],j=b[h.getInVertex().id===e.id?h.getOutVertex().id:h.getInVertex().id];-1===d.indexOf(j.id)&&(c.push(j),d.push(j.id),e.children.push(j),j.parent=e)}}},d=function(a,b,f){a.number=b,a.depth=f;var g;if(0===a.children.length)g=l(a),a.prelim=c.isUndefined(g)?0:g.prelim+m(g,a,!0);else{for(var h=a.children[0],i=a.children[a.children.length-1],j=h,n=0;n<a.children.length;n++){var o=a.children[n];d(o,n,f+1),j=e(o,j)}k(a);var p=.5*(h.prelim+i.prelim);g=l(a),c.isUndefined(g)?a.prelim=p:(a.prelim=g.prelim+m(g,a,!0),a.mod=a.prelim-p)}},e=function(a,b){var d=l(a);if(!c.isUndefined(d)){for(var e=a,i=a,k=d,n=a.parent.children[0],o=e.mod,p=k.mod,q=i.mod,r=n.mod,s=g(k),t=f(e);!c.isUndefined(s)&&!c.isUndefined(t);){k=s,e=t,n=f(n),i=g(i),i.ancestor=a;var u=k.prelim+p-(e.prelim+o)+m(k,e,!1);u>0&&(h(j(k,a,b),a,u),o+=u,q+=u),p+=k.mod,o+=e.mod,r+=n.mod,q+=i.mod,s=g(k),t=f(e)}!c.isUndefined(s)&&c.isUndefined(g(i))&&(i.thread=s,i.mod+=p-q),!c.isUndefined(t)&&c.isUndefined(f(n))&&(n.thread=t,n.mod+=o-r,b=a)}return b},f=function(a){return a.children.length>0?a.children[0]:a.thread},g=function(a){return a.children.length>0?a.children[a.children.length-1]:a.thread},h=function(a,b,c){var d=b.number-a.number;b.change-=c/d,b.shift+=c,a.change+=c/d,b.prelim+=c,b.mod+=c},j=function(a,b,c){return a.ancestor.parent===b.parent?a.ancestor:c},k=function(a){for(var b=0,c=0,d=a.children.length-1;d>=0;d--){var e=a.children[d];e.prelim+=b,e.mod+=b,c+=e.change,b+=e.shift+c}},l=function(a){if(!c.isUndefined(a.parent))for(var b=0;b<a.parent.children.length;b++){var d=a.parent.children[b];if(b>0&&d.id===a.id)return a.parent.children[b-1]}return void 0},m=function(b,c,d){return(d?a.SIBLING_NODE_DISTANCE:a.SUBTREE_DISTANCE)+p},n=function q(b,c,d,e,f){var g=e/2+b.prelim+c;f>g&&(f=g);for(var h=0;h<b.children.length;h++)f=q(b.children[h],c+b.mod,d,e,f);return b.endX=e/2+b.prelim+c+(a.PADDING-f),b.endY=b.depth*a.DEPTH_DISTANCE+a.PADDING,b.endX>d.maxX&&(d.maxX=b.endX),b.endY>d.maxY&&(d.maxY=b.endY),b.depth>d.maxDepth&&(d.maxDepth=b.depth),f},o=function(b,c,d){var e=Math.min((c-a.PADDING)/b.maxX,(d-a.PADDING)/b.maxY);return e>1?1:e};return c.mixin(a.prototype,{step:function(e,f,g,h,i){var j=e.length;if(this.running){j=0;for(var k={},l=0;l<e.length;l++){var m=e[l];m.started?(this.tween.runFrame(m,this.scale),m.finished&&j++):(m.mod=0,m.prelim=0,m.shift=0,m.change=0,m.thread=void 0,m.ancestor=m,m.number=-1,k[m.id]=m)}var p=c.isUndefined(i)?e[0]:i;if(!p.started){var q=this,r=0;b(p,k),d(p,0,r),n(p,-p.prelim,q,g,a.PADDING);for(var s=!0;s;){for(s=!1,l=0;l<e.length;l++)if(c.isUndefined(e[l].endX)||c.isUndefined(e[l].endY)){p=e[l],s=!0;break}s&&(b(p,k),r=q.maxDepth+1,d(p,0,r),n(p,-p.prelim,q,g,a.PADDING))}for(this.scale=o(q,g,h),l=0;l<e.length;l++){var t=e[l];a.setBeginPoint(t,p),this.tween.start(t,this.scale)}}}return this.running&&j===e.length&&e.length>0&&e[0].vertex.getGraph().trigger("graphUpdated"),this.running=j<e.length,this.running}}),a.setBeginPoint=function(a,b){c.isUndefined(a.x)||c.isUndefined(a.y)?(a.beginX=b.endX,a.beginY=b.endY,a.x=b.endX,a.y=b.endY):(a.beginX=a.x,a.beginY=a.y)},a}(),ua=function(){function a(a,b){this.running=!0,this.started=!1,this.maxIteration=700,this.tween=new pa(a,b),this.name="fruchtermanReingold"}var b=1e-6,d=15,e=function(b,d,e,f){var g=b.length;f.temp=d/10,f.forceConstant=1.2*Math.sqrt(e*d/g);for(var h=0;h<b.length;h++){var i=b[h];a.setBeginPoint(i,d,e),i.endX=c.randomInteger(0,d),i.endY=c.randomInteger(0,e)}},f=function(a,c,d){c.disp=[0,0];for(var e=0;e<a.length;e++){var f=a[e];if(c.id!==f.id){var g=c.endX-f.endX,h=c.endY-f.endY,i=Math.max(b,Math.sqrt(g*g+h*h)),j=d.forceConstant*d.forceConstant/i;c.disp[0]+=g/i*j,c.disp[1]+=h/i*j}}},g=function(a,c){var d=a.inVertex,e=a.outVertex,f=d.endX-e.endX,g=d.endY-e.endY,h=Math.max(b,Math.sqrt(f*f+g*g)),i=h*h/c.forceConstant,j=f/h*i,k=g/h*i;d.disp[0]-=j,d.disp[1]-=k,e.disp[0]+=j,e.disp[1]+=k},h=function(a,c,e,f){var g=Math.max(b,Math.sqrt(a.disp[0]*a.disp[0]+a.disp[1]*a.disp[1])),h=a.disp[0]/g*Math.min(g,f.temp),i=a.disp[1]/g*Math.min(g,f.temp);a.endX+=h,a.endY+=i;var j=c/50,k=a.endX;2*p+j>k?k=2*p+j+Math.random()*j*2:k>c-j&&(k=c-j-Math.random()*j*2);var l=a.endY;p+j>l?l=p+j+Math.random()*j*2:l>e-j&&(l=e-j-Math.random()*j*2),a.endX=k,a.endX=Math.max(a.endX,p/2+d),a.endX=Math.min(a.endX,c-p/2-d),a.endY=l,a.endY=Math.max(a.endY,p/2+d),a.endY=Math.min(a.endY,e-p/2-d)},i=function(a,b){a.temp*=1-b/a.maxIteration},j=function(a,b,c,d){var e;return e=a>b?a/c:b/d,e>1?1:e};return c.mixin(a.prototype,{step:function(a,b,c,d){var k=a.length,l=a.length*(p/1.5);l=Math.max(l,c);var m=l*(d/c),n=j(c,d,l,m);if(this.running){var o,q;if(!this.started){for(e(a,l,m,this),o=0;o<this.maxIteration;o++){for(var r=0;r<a.length;r++)q=a[r],f(a,q,this);for(r=0;r<b.length;r++){var s=b[r];g(s,this)}for(r=0;r<a.length;r++)q=a[r],h(q,l,m,this);i(this,o)}this.started=!0}for(k=0,o=0;o<a.length;o++)q=a[o],q.started?(this.tween.runFrame(q,n),q.finished&&k++):this.tween.start(q,n)}return this.running&&k===a.length&&a.length>0&&a[0].vertex.getGraph().trigger("graphUpdated"),this.running=k<a.length,this.running}}),a.setBeginPoint=function(a,b,d){c.isUndefined(a.x)||c.isUndefined(a.y)?(a.beginX=b/2,a.beginY=d/2,a.x=a.beginX,a.y=a.beginY):(a.beginX=a.x,a.beginY=a.y)},a}(),va=function(){function a(){this.name="fixed"}return c.mixin(a.prototype,{step:function(){return!1}}),a}(),wa=function(){function a(a,b){this.running=!0,this.tween=new pa(a,b),this.name="tossToBorder"}var b=20,d=70,f=function(a,c,d,i,j){for(var k=0,l=0;l<a.length;l++){var m=a[l];if(m.id!==c.id){var n={width:e.widthOf(m),height:e.heightOf(m),beginX:m.vertex.getPropertyUnfiltered("_beginX"),beginY:m.vertex.getPropertyUnfiltered("_beginY")};k+=h(d,n)}}j[k]={x:d.beginX,y:d.beginY};var o=d.beginX>b+d.width/2&&d.beginX<i.width-b-d.width/2,p=d.beginY>b+d.height/2&&d.beginY<i.height-b-d.height/2;return k>0&&o&&p&&(g(c,d,i),d.beginX=c.vertex.getPropertyUnfiltered("_beginX"),d.beginY=c.vertex.getPropertyUnfiltered("_beginY"),f(a,c,d,i,j)),j},g=function(a,b,c){var d=b.beginX-c.centerX>0?b.beginX+1:b.beginX-1,e=(b.beginY-c.centerY)*(d-c.centerX)/(b.beginX-c.centerX)+c.centerY;a.vertex.setPropertyUnfiltered("_beginX",d),a.vertex.setPropertyUnfiltered("_beginY",e)},h=function(a,b){var c=a.beginX-a.width/2-d,e=a.beginY-a.height/2-d,f=a.beginX+a.width/2+d,g=a.beginY+a.height/2+d,h=b.beginX-b.width/2,i=b.beginY-b.height/2,j=b.beginX+b.width/2,k=b.beginY+b.height/2,l=Math.max(0,Math.min(f,j)-Math.max(c,h)),m=Math.max(0,Math.min(g,k)-Math.max(e,i));return l*m};return c.mixin(a.prototype,{step:function(b,c,d,g){var h=b.length,i=1,j={centerX:d*(.5/i),centerY:g*(.5/i),width:d,height:g};if(this.running){h=0;for(var k=0;k<b.length;k++){var l=b[k];if(void 0===l.g)return!0;if(l.started)this.tween.runFrame(l,i),l.finished&&h++;else{var m={beginX:l.vertex.getPropertyUnfiltered("_beginX"),beginY:l.vertex.getPropertyUnfiltered("_beginY"),width:e.widthOf(l),height:e.heightOf(l)};a.setBeginPoint(l,m),l.endX=m.beginX,l.endY=m.beginY;var n=f(b,l,m,j,{}),o=null;for(var p in n)(null===o||o>p)&&(o=p,l.endX=n[o].x,l.endY=n[o].y);this.tween.start(l,i)}}}return this.running&&h===b.length&&b.length>0&&b[0].vertex.getGraph().trigger("graphUpdated"),this.running=h<b.length,this.running}}),a.setBeginPoint=function(a,b){c.isUndefined(a.x)||c.isUndefined(a.y)?(a.beginX=b.beginX,a.beginY=b.beginY,a.x=a.beginX,a.y=a.beginY):(a.beginX=a.x,a.beginY=a.y)},a}(),xa={setScale:function(a){d3.select("#graphElements").attr("transform","scale("+a+")")},getScale:function(){var a=d3.select("#graphElements");if(a.empty())return 1;var b=a.attr("transform");return b.substring(6,b.length-1)}},ya={expoInOut:function(a,b,c,d){return 0===a?b:a===d?b+c:(a/=d/2,1>a?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b)}},za=function(){function a(a,d){c.checkExists("Graph",a),this.graph=a,this.container=d.container,this.navigatorContainer=d.navigatorContainer,this.engine=d.engine,this.settings=d,this.layoutId=this.settings.defaultLayout,b(this),h(a,this,this.engine)}function b(a){a.initialized=!1,a.vertices=[],a.verticesById={},a.edges=[],a.edgesById={};var b=a.settings.layouts[a.layoutId];a.layout=new b(a.settings.animationDuration,a.settings.easing)}function d(a,b){var c={id:a.getId(),vertex:a};b.vertices.push(c),b.verticesById[c.id]=c}function e(a,b){var c=a.getInVertex().getId(),d=a.getOutVertex().getId(),e={id:a.getId(),edge:a,inVertex:b.verticesById[c],outVertex:b.verticesById[d]};b.edges.push(e),b.edgesById[e.id]=e}function f(a,b){var d=b.verticesById[a.getId()];c.remove(d,b.vertices),delete b.verticesById[d.id]}function g(a,b){var d=b.edgesById[a.getId()];c.remove(d,b.edges),delete b.edgesById[d.id]}function h(a,b,h){if(a.on("vertexAdded",function(a,c){d(c,b)}),a.on("edgeAdded",function(a,c){e(c,b)}),a.on("vertexRemoved",function(a,c){f(c,b)}),a.on("edgeRemoved",function(a,c){g(c,b)}),a.on("vertexClicked",function(a,c){b.selectedVertex=c}),a.on("vertexDragStart",function(a,c){h.moveVertexToFront(c.uiElement),b.selectedVertex=c}),a.on("propertyUpdated",function(a,d,e,f,g){c.isOfType(d,D)?h.vertexPropertyUpdated(b.verticesById[d.getId()],e,f,g):h.edgePropertyUpdated(b.edgesById[d.getId()],e,f,g)}),a.on("propertyRemoved",function(a,d,e,f){c.isOfType(d,D)?h.vertexPropertyRemoved(b.verticesById[d.getId()],e,f):h.edgePropertyRemoved(b.edgesById[d.getId()],e,f)}),!b.settings.width){var j,k=!1,l=200;window.addEventListener("resize",function(){j=new Date,k===!1&&(k=!0,setTimeout(m,l))});var m=function(){new Date-j<l?setTimeout(m,l):(k=!1,i(b))}}}function i(a){var c=j(a.settings.container);a.settings.width!==c&&(a.settings.width=null,a.stop(),b(a),a.render())}function j(a){var b=document.getElementById(a.substring(1));if(!b)throw{message:"Cannot find graph container"};return b.offsetWidth}return c.mixin(a.prototype,{render:function(){this.initialized||this.init(),this.timer||(this.timer=new Q(this.onAnimationFrame,this),this.timer.start())},onAnimationFrame:function(){var a=this.layout.step(this.vertices,this.edges,this.settings.width,this.settings.height,this.selectedVertex);return this.renderFrame(),a},renderFrame:function(){this.engine.beforeRender(this.vertices,this.edges);var a=this;this.graph.forEachVertex(function(b){'use strict';a.engine.renderVertex(b)})},init:function(){this.settings.width||(this.settings.width=j(this.settings.container)),this.engine.init(this.settings,this.graph,this);var a=this;this.graph.forEachVertex(function(b){'use strict';a.verticesById[b.getId()]||d(b,a),a.engine.initVertex(b)}),this.graph.forEachEdge(function(b){'use strict';a.edgesById[b.getId()]||e(b,a)}),this.initialized=!0},saveAsImage:function(){this.engine.saveAsImage()},changeLayout:function(a){for(var b=0;b<this.vertices.length;b++){var c=this.vertices[b];c.started=!1,c.finished=!1,c.endX=void 0,c.endY=void 0}this.layoutId=a;var d=this.settings.layouts[a];this.layout=new d(this.settings.animationDuration,this.settings.easing),this.graph.trigger("graphZoomOut")},stop:function(){this.timer&&(this.timer.stop(),this.timer=null),this.engine.stop()},resize:function(){i(this)},setPosition:function(a,b,d){c.checkExists(b,"x coordinate must be specified"),c.checkExists(d,"y coordinate must be specified");var e=this.verticesById[a.getId()];e&&(e.x=b,e.y=d)},select:function(a){var b=this.verticesById[a.getId()];b&&(this.selectedVertex=b)}}),a}(),Aa=function(){function a(){}var b=["_id","_type","_label","_outV","_inV"],d=function(a,c){for(var d in a)-1===b.indexOf(d)&&c.setProperty(d,a[d])};return c.mixin(a.prototype,{read:function(a,b){for(var e=0;e<b.graph.vertices.length;e++){var f=b.graph.vertices[e],g=a.getVertex(f._id);c.exists(g)||(g=a.addVertex(f._id)),d(f,g)}for(e=0;e<b.graph.edges.length;e++){var h=b.graph.edges[e],i=a.getEdge(h._id);if(!c.exists(i)){var j=a.getVertex(h._outV),k=a.getVertex(h._inV);i=a.addEdge(h._id,j,k,h._label)}d(h,i)}return a}}),a}(),Ba={container:null,navigatorContainer:null,engine:new ea,defaultLayout:"circle",layouts:{random:S,circle:qa,wheel:ra,grid:sa,tree:ta,fruchtermanReingold:ua,fixed:va,tossToBorder:wa},animationDuration:1e3,easing:ya.expoInOut,raphael:{defaultVertexRenderer:na,vertexRenderers:{}},d3:{defaultVertexRenderer:new ka("circle"),defaultEdgeRenderer:new ha,vertexRenderers:{circle:new ka("circle"),cross:new ka("cross"),diamond:new ka("diamond"),square:new ka("square"),"triangle-down":new ka("triangle-down"),"triangle-up":new ka("triangle-up"),"image-vertex":new ia,"query-result-vertex":new ja,"labeled-image-vertex":new Z(new ia,{labelInside:!0,labelTop:!1,padding:10,labelPropertyKey:"additionalLabel"}),"bordered-image-vertex":new X(new ia)},edgeRenderers:{"curved-line":new fa,"labeled-curved-line":new W(new fa)}},height:680,zoom:{enabled:!0,minScale:1,maxScale:8,defaultScale:.5
},drag:{enabled:!0,delay:100},navigator:{enabled:!0,scale:.25},zoomPanControl:{enabled:!0,zoomStep:.25,panStep:50,paddingTop:5,paddingLeft:10},vertex:{imageUrlPropertyKey:"imageUrl",borderColorPropertyKey:"borderColor",borderWeightPropertyKey:"borderWeight",borderRadiusPropertyKey:"borderRadius",borderPaddingPropertyKey:"borderPadding",borderColor:"#000000",borderWeight:2,borderRadius:0,borderPadding:5,icons:{propertyKey:"icons",insideVertex:!0,borderRadius:0,horizontalMargin:3,iconSetMargin:2,iconPadding:2,positioning:r}},edge:{lineWeightPropertyKey:"strength",defaultLineWeight:2,useArrows:!0,aggregatedByPropertyKey:"aggregatedBy"},icons:{activeIcons:[],iconSet:{spam:"M16 11.5l-4.5-11.5h-7l-4.5 4.5v7l4.5 4.5h7l4.5-4.5v-7l-4.5-4.5zM9 13h-2v-2h2v2zM9 9h-2v-6h2v6z",airplane:"M12 9.999l-2.857-2.857 6.857-5.143-2-2-8.571 3.429-2.698-2.699c-0.778-0.778-1.864-0.964-2.414-0.414s-0.364 1.636 0.414 2.414l2.698 2.698-3.429 8.572 2 2 5.144-6.857 2.857 2.857v4h2l1-3 3-1v-2l-4 0z",share:"M13.5 11c-0.706 0-1.342 0.293-1.797 0.763l-6.734-3.367c0.021-0.129 0.032-0.261 0.032-0.396s-0.011-0.267-0.032-0.396l6.734-3.367c0.455 0.47 1.091 0.763 1.797 0.763 1.381 0 2.5-1.119 2.5-2.5s-1.119-2.5-2.5-2.5-2.5 1.119-2.5 2.5c0 0.135 0.011 0.267 0.031 0.396l-6.734 3.367c-0.455-0.47-1.091-0.763-1.797-0.763-1.381 0-2.5 1.119-2.5 2.5s1.119 2.5 2.5 2.5c0.706 0 1.343-0.293 1.797-0.763l6.734 3.367c-0.021 0.129-0.031 0.261-0.031 0.396 0 1.381 1.119 2.5 2.5 2.5s2.5-1.119 2.5-2.5c0-1.381-1.119-2.5-2.5-2.5z",close:"M15.854 12.854c-0-0-0-0-0-0l-4.854-4.854 4.854-4.854c0-0 0-0 0-0 0.052-0.052 0.090-0.113 0.114-0.178 0.066-0.178 0.028-0.386-0.114-0.529l-2.293-2.293c-0.143-0.143-0.351-0.181-0.529-0.114-0.065 0.024-0.126 0.062-0.178 0.114 0 0-0 0-0 0l-4.854 4.854-4.854-4.854c-0-0-0-0-0-0-0.052-0.052-0.113-0.090-0.178-0.114-0.178-0.066-0.386-0.029-0.529 0.114l-2.293 2.293c-0.143 0.143-0.181 0.351-0.114 0.529 0.024 0.065 0.062 0.126 0.114 0.178 0 0 0 0 0 0l4.854 4.854-4.854 4.854c-0 0-0 0-0 0-0.052 0.052-0.090 0.113-0.114 0.178-0.066 0.178-0.029 0.386 0.114 0.529l2.293 2.293c0.143 0.143 0.351 0.181 0.529 0.114 0.065-0.024 0.126-0.062 0.178-0.114 0-0 0-0 0-0l4.854-4.854 4.854 4.854c0 0 0 0 0 0 0.052 0.052 0.113 0.090 0.178 0.114 0.178 0.066 0.386 0.029 0.529-0.114l2.293-2.293c0.143-0.143 0.181-0.351 0.114-0.529-0.024-0.065-0.062-0.126-0.114-0.178z",cross:"M11.479 10.522l-2.206-2.522 2.206-2.522c0.375-0.375 0.375-0.983 0-1.358s-0.983-0.374-1.358 0l-2.122 2.425-2.121-2.424c-0.375-0.375-0.983-0.375-1.358 0s-0.374 0.983 0 1.358l2.206 2.521-2.206 2.522c-0.374 0.375-0.374 0.982 0 1.356s0.983 0.375 1.358 0l2.122-2.423 2.121 2.423c0.375 0.375 0.983 0.375 1.358 0s0.375-0.981 0.001-1.356z",remove:"M3 16h10l1-11h-12zM10 2v-2h-4v2h-5v3l1-1h12l1 1v-3h-5zM9 2h-2v-1h2v1z",remove2:"M12.5 2h-9c-0.828 0-1.5 0.672-1.5 1.5v0.5h12v-0.5c0-0.828-0.672-1.5-1.5-1.5zM9.88 1l0.221 1.578h-4.201l0.221-1.578h3.76zM10 0h-4c-0.412 0-0.797 0.334-0.854 0.743l-0.292 2.093c-0.057 0.409 0.234 0.743 0.646 0.743h5c0.412 0 0.703-0.334 0.646-0.743l-0.292-2.093c-0.057-0.409-0.441-0.743-0.854-0.743v0zM12.75 5h-9.5c-0.55 0-0.959 0.448-0.909 0.996l0.819 9.008c0.050 0.548 0.541 0.996 1.091 0.996h7.5c0.55 0 1.041-0.448 1.091-0.996l0.819-9.008c0.050-0.548-0.359-0.996-0.909-0.996zM6 14h-1.5l-0.5-7h2v7zM9 14h-2v-7h2v7zM11.5 14h-1.5v-7h2l-0.5 7z",menu2:"M1 3h14v3h-14zM1 7h14v3h-14zM1 11h14v3h-14z"}}},Ca=function(){function a(a){c.checkExists("Graph",a),this.graph=a,this.vertexOperator=k,this.edgeOperator=k,this.executed=!1,this.filters=[],b(this)}function b(a){a.normalGraph=new E,a.aggregatedGraph=new E,a.filteredVertices=[],a.filteredEdges=[],a.filteredAggregatedVertices=[],a.filteredAggregatedEdges=[]}function d(a){e(a.graph.getVertices(),a,h),e(a.graph.getEdges(),a,p),a.executed=!0}function e(a,b,d){for(var e=0;e<a.length;e++){var g=a[e],h=b.filters,i=c.isOfType(g,D)?b.vertexOperator:b.edgeOperator,j=f(g,h,i);d(g,b,j)}}function f(a,b,c){for(var d=0,e=b.length,f=0,h=!1,i=0;e>i;i++){var j=!0,l=b[i];if(g(a,l)){for(var m=l.hasConditions,n=0;n<m.length;n++)m[n].matches(a)||(j=!1);j?(!l.active()&&l.enabled()?d++:l.active()&&(h=!0),l.count(l.count()+1)):l.active()&&d++}else f++}return c===k?d>0:d===e-f||!h}function g(a,b){return c.isOfType(a,D)&&b.type()===m||c.isOfType(a,C)&&b.type()===n||b.type()===o}function h(a,b,c){c?(b.filteredVertices.push(a),b.filteredAggregatedVertices.push(a)):(j(b.normalGraph,a),j(b.aggregatedGraph,a))}function j(a,b){var c=a.addVertex(b.id);b.copyPropertiesTo(c)}function p(a,b,c){var d=b.normalGraph.getVertex(a.getInVertex().id),e=b.normalGraph.getVertex(a.getOutVertex().id),f=null!==d&&null!==e;f&&!c?(t(b.normalGraph,a,d,e),q(b,a)):(u(b,a),b.filteredEdges.push(a))}function q(a,b){var c=a.aggregatedGraph.getVertex(b.getInVertex().id),d=a.aggregatedGraph.getVertex(b.getOutVertex().id),e=a.graph.getSettings(),f=b.getProperty(e.edge.lineWeightPropertyKey)||e.edge.defaultLineWeight,g=c.getEdges(i);if(r(c,d))s(g,c,d,f,b);else{var h=a.aggregatedGraph.addEdge(null,d,c);b.copyPropertiesTo(h),h.setProperty(e.edge.lineWeightPropertyKey,f),h.setProperty(e.edge.aggregatedByPropertyKey,[b.getId()])}}function r(a,b){for(var c=a.getEdges(i),d=0;d<c.length;d++){var e=c[d];if(e.connects(a,b))return!0}return!1}function s(a,b,c,d,e){for(var f=0;f<a.length;f++){var g=a[f],h=g.connects(b,c);if(h){d+=g.getProperty(Ba.edge.lineWeightPropertyKey)||Ba.edge.defaultLineWeight,g.setProperty(Ba.edge.lineWeightPropertyKey,d);var i=g.getProperty(Ba.edge.aggregatedByPropertyKey)||[];i.push(e.getId()),g.setProperty(Ba.edge.aggregatedByPropertyKey,i)}}}function t(a,b,c,d){var e=a.addEdge(b.id,d,c,b.label);b.copyPropertiesTo(e)}function u(a,b){for(var c=b.getProperty(Ba.edge.lineWeightPropertyKey)||Ba.edge.defaultLineWeight,d=!1,e=0;e<a.filteredAggregatedEdges.length;e++){var f=a.filteredAggregatedEdges[e],g=b.connects(f.getInVertex(),f.getOutVertex());if(g){d=!0,c+=f.getProperty(Ba.edge.lineWeightPropertyKey)||Ba.edge.defaultLineWeight,b.copyPropertiesTo(f),f.setProperty(Ba.edge.lineWeightPropertyKey,c);var h=f.getProperty(Ba.edge.aggregatedByPropertyKey)||[];h.push(b.getId()),f.setProperty(Ba.edge.aggregatedByPropertyKey,h);break}}if(a.filteredAggregatedEdges.length<1||!d){var i=v(b.getOutVertex(),b.getInVertex(),c,b,a);i.setProperty(Ba.edge.aggregatedByPropertyKey,[b.getId()]),a.filteredAggregatedEdges.push(i)}}function v(a,b,d,e,f){for(var g=c.generateId();null!==f.aggregatedGraph.getEdge(g);)g=c.generateId();var h=new C(g,a,b,null,f.aggregatedGraph);return e.copyPropertiesTo(h),h.setProperty(Ba.edge.lineWeightPropertyKey,d),h}function w(a){for(var b=0;b<a.length;b++)a[b].count(0)}return c.mixin(a.prototype,{addFilter:function(a){return a=a||new Da,this.filters.push(a),a},vertexFilterOperator:function(a){return c.checkArgument(a===k||a===l,"Operator can be only AND or OR"),this.vertexOperator=a,this},edgeFilterOperator:function(a){return c.checkArgument(a===k||a===l,"Operator can be only AND or OR"),this.edgeOperator=a,this},getNormalGraph:function(){return this.executed||d(this),this.normalGraph},getAggregatedGraph:function(){return this.executed||d(this),this.aggregatedGraph},getFilteredVertices:function(){return this.executed||d(this),this.filteredVertices},getFilteredEdges:function(){return this.executed||d(this),this.filteredEdges},getFilteredAggregatedVertices:function(){return this.executed||d(this),this.filteredAggregatedVertices},getFilteredAggregatedEdges:function(){return this.executed||d(this),this.filteredAggregatedEdges},reset:function(){return this.executed=!1,b(this),w(this.filters),this}}),a}(),Da=function(){function a(){this.filterName=null,this.filterId=null,this.elementCount=0,this.activeFlag=!0,this.enable=!0,this.elementType=o,this.labelFilterActivated=!1,this.initHasConditions()}return c.mixin(a.prototype,K),c.mixin(a.prototype,{id:function(a){return arguments.length?(this.filterId=a,this):this.filterId},active:function(a){return arguments.length?(this.activeFlag=a,this):this.activeFlag},enabled:function(a){return arguments.length?(this.enable=a,this):this.enable},type:function(a){return arguments.length?(c.checkArgument(!this.labelFilterActivated||a===n,"If label filter added the type could not be changed."),this.elementType=a,this):this.elementType},count:function(a){return arguments.length?(this.elementCount=a,this):this.elementCount},incrementCount:function(a){return a=a||1,this.elementCount+=a,this},decrementCount:function(a){return a=a||1,this.elementCount-=a,this},name:function(a){return arguments.length?(this.filterName=a,this):this.filterName},addCondition:function(a){return c.checkExists("Condition",a),this.hasConditions.push(a),this},label:function(){var a=c.convertVarArgs(arguments);return this.hasConditions.push(new J(a)),this.labelFilterActivated=!0,this.elementType=n,this}}),a}(),Ea=function(){function a(){}function b(a,b,c){for(var d=a.getPropertyKeys(),e=0;e<d.length;e++){var f=d[e],g=a.getPropertyUnfiltered(f);-1===c.indexOf(f)&&(b[f]=g)}}function d(a,c,d){for(var e=a.getVertices(),f=0;f<e.length;f++){var g=e[f],h={};h[u]=g.id,b(g,h,d),c.vertices.push(h)}}function e(a,c,d){for(var e=a.getEdges(),f=0;f<e.length;f++){var i=e[f],j={};j[u]=i.id,j[x]=i.label,j[v]=i.getVertex(h).id,j[w]=i.getVertex(g).id,b(i,j,d),c.edges.push(j)}}return c.mixin(a.prototype,{write:function(a,b,f,g){c.exists(b)||(b=[]),c.exists(f)||(f=[]),c.exists(g)||(g="NORMAL");var h={mode:g,vertices:[],edges:[]};return d(a,h,b),e(a,h,f),h}}),a}();a.settings=Ba,a.Edge=C,a.Vertex=D,a.Graph=E,a.VisualGraph=V,a.InternalPropertyFilter=F,a.VertexQuery=O,a.GraphQuery=O,a.Index=G,a.RandomLayout=S,a.ForceDirectedLayout=T,a.FixedLayout=va,a.ElementFilterManager=Ca,a.ElementFilter=Da,a.D3Navigator=ca,a.D3SvgImageDownloader=_,a.D3ZoomPanManager=aa,a.D3VertexManager=ba,a.D3ZoomPanControl=da,a.ElementRendererDecorator=U,a.D3VertexLabelDecorator=Z,a.D3VertexBorderDecorator=X,a.D3VertexIconDecorator=Y,a.D3EdgeLabelDecorator=W,a.D3Engine=ea,a.D3ImageVertexRenderer=ia,a.D3SymbolVertexRenderer=ka,a.D3QueryResultVertexRenderer=ja,a.D3LineEdgeRenderer=ha,a.D3DirectedLineEdgeRenderer=fa,a.BoundingBoxCalculator=R,a.RaphaelEngine=ma,a.RaphaelRectangleVertexRenderer=na,a.Renderer=za,a.Point=z,a.Rectangle=A,a.GeometryUtils=d,a.SvgUtils=e,a.DomUtils=f,a.OUT=g,a.IN=h,a.BOTH=i,a.PROP_TYPE=j,a.AND=k,a.OR=l,a.BOTH_FILTER=o,a.VERTEX_FILTER=m,a.EDGE_FILTER=n,a.NODE_WIDTH=p,a.TOP_LEFT=q,a.TOP_RIGHT=r,a.BOTTOM_LEFT=t,a.BOTTOM_RIGHT=s,a.ID=u,a.IN_V=v,a.OUT_V=w,a.LABEL=x,a.QueryResultVertexPropertyPredicate=la,a.GraphSONReader=Aa,a.Tween=pa,a.CircleLayout=qa,a.WheelLayout=ra,a.GridLayout=sa,a.NodeLinkTreeLayout=ta,a.FruchtermanReingoldLayout=ua,a.TossToBorderLayout=wa,a.LayoutUtils=xa,a.Easing=ya,a.Compare=L,a.Contains=M,a.GraphSONWriter=Ea}({},function(){return this}());